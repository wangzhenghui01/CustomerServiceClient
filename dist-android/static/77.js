webpackJsonp([77],{410:function(t,e,o){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=o(2),a=r(s),n=o(4),l=r(n),c=o(3),i=function(){var t=(0,l.default)(a.default.mark(function t(e){var o;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:o={f_cost_name:e.model.f_cost_name,f_cost_money:e.model.f_cost_money,f_processid:e.selectdata.f_process_id,f_remarks:e.model.f_remarks,f_state:"1",f_material_operator:e.$login.f.name},console.log("新增成本项",o),e.$resetpost("rs/logic/insertcost",o).then(function(){console.log("更新成功！"),e.search()}),e.search(),e.modifyshow=!1;case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),d=function(){var t=(0,l.default)(a.default.mark(function t(e){var o;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:o={id:e.updaterow.id,f_state:"0"},console.log("移除成本项",o),e.$resetpost("rs/logic/insertcost",o).then(function(){console.log("更新成功！"),e.search()}),e.search(),e.modifyshow=!1;case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),f=function(){var t=(0,l.default)(a.default.mark(function t(e){var o;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:o={id:e.updaterow.id,f_cost_name:e.updaterow.f_cost_name,f_remarks:e.updaterow.f_remarks,f_cost_money:e.updaterow.f_cost_money},console.log("修改成本项",o),e.$resetpost("rs/logic/insertcost",o).then(function(){console.log("更新成功！"),e.search()}),e.search(),e.updateshow=!1;case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}();e.default={title:"工程结算",props:["selectdata","edit"],data:function(){return{model:new c.PagedList("rs/sql/getMaterialFinal",8,{orderitem:"`id`"}),othermodel:new c.PagedList("rs/sql/getCost",8,{orderitem:"`id`"}),number:0,cost:0,all:0,modifyshow:!1,updateshow:!1,updaterow:null}},ready:function(){this.search()},methods:{search:function(){console.log("执行查询");var t=" processid  = '"+this.selectdata.f_process_id+"'",e=" f_processid  = '"+this.selectdata.f_process_id+"'";this.model.search(t),this.othermodel.search(e),this.getnumber(t)},getcost:function(){var t=this,e=" f_processid  = '"+this.selectdata.f_process_id+"'";this.$resetpost("rs/sql/getCostAll",{data:{condition:e,orderitem:"f_cost desc"}},{resolveMsg:null,rejectMsg:null}).then(function(e){console.log("res2",e.data[0].f_cost),e.data[0].f_cost&&(t.cost=e.data[0].f_cost),console.log("2222222222222222")})},getnumber:function(t){var e=this;this.$resetpost("rs/sql/getMaterialPrice",{data:{condition:t,orderitem:"f_price desc"}},{resolveMsg:null,rejectMsg:null}).then(function(t){console.log("res",t.data[0].f_price),t.data[0].f_price&&(e.number=t.data[0].f_price),e.getcost(),console.log("11111111111")})},modify:function(){this.modifyshow=!0},modifyclose:function(){this.modifyshow=!1},modifyConfirm:function(){function t(){return e.apply(this,arguments)}var e=(0,l.default)(a.default.mark(function t(){var e=this;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.model.f_cost_name){t.next=3;break}return this.$showAlert("请输入成本项","warning",1500),t.abrupt("return");case 3:if(this.model.f_cost_money){t.next=6;break}return this.$showAlert("请输入成本金额","warning",1500),t.abrupt("return");case 6:return t.next=8,this.$showMessage("是否确认添加新的成本项",["confirm","cancel"]).then(function(t){"confirm"===t&&i(e)});case 8:case"end":return t.stop()}},t,this)}));return t}(),update:function(t){this.updaterow=t,this.updateshow=!0},updateclose:function(){this.search(),this.updateshow=!1},updateConfirm:function(){function t(){return e.apply(this,arguments)}var e=(0,l.default)(a.default.mark(function t(){var e=this;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.updaterow.f_cost_name){t.next=3;break}return this.$showAlert("请输入成本项","warning",1500),t.abrupt("return");case 3:if(this.updaterow.f_cost_money){t.next=6;break}return this.$showAlert("请输入成本金额","warning",1500),t.abrupt("return");case 6:return t.next=8,this.$showMessage("是否确认修改此成本项",["confirm","cancel"]).then(function(t){"confirm"===t&&f(e)});case 8:case"end":return t.stop()}},t,this)}));return t}(),delete:function(t){var e=this;this.updaterow=t,this.$showMessage("是否确认删除此成本项",["confirm","cancel"]).then(function(t){"confirm"===t&&d(e)})}},computed:{},events:{},watch:{number:function(){this.all=this.cost+this.number,this.$dispatch("get-price",this.all,"点火")},cost:function(){this.all=this.cost+this.number,this.$dispatch("get-price",this.all,"点火")}}}},832:function(t,e){t.exports=' <div class=flex style="height: auto"> <div style="height: auto" class=flex> <p class="bg-info text-center" style="padding: 8px;font-size: 20px">最终材料表 </p> <div class="form-inline auto" style="margin-bottom: 5px"> <criteria-paged :model=model :pager=true v-ref:paged> <data-grid :model=model v-ref:grid partial=list> <template partial=head> <tr> <th><nobr>序号</nobr></th> <th><nobr>材料名称</nobr></th> <th><nobr>数量</nobr></th> <th><nobr>单位</nobr></th> <th><nobr>单价</nobr></th> <th><nobr>合计金额</nobr></th> </tr> </template> <template partial=body> <td style="text-align: center">{{$index + 1}}</td> <td style="text-align: center">{{row.f_batch_name}}</td> <td style="text-align: center">{{row.f_add_receive}}</td> <td style="text-align: center">{{row.f_batch_company}}</td> <td style="text-align: center">{{row.f_batch_price}}</td> <td style="text-align: center">{{row.totalprice}}</td> </template> </data-grid> </criteria-paged> </div> </div> <div style="height: auto" class=flex> <div class="bg-info text-center" style="padding: 8px;font-size: 20px">其他成本 </div> <div class="form-inline auto bg-info" style="float: right"> <div class=form-group style="float: right"> <button class="btn btn-success" @click=modify()>新增</button> </div> </div> <div class="form-inline auto" style="margin-bottom: 5px"> <criteria-paged :model=othermodel :pager=true v-ref:paged1> <data-grid :model=$parent.othermodel v-ref:grid1 partial=list> <template partial=head> <tr> <th><nobr>序号</nobr></th> <th><nobr>成本项</nobr></th> <th><nobr>成本金额</nobr></th> <th><nobr>备注</nobr></th> <th><nobr>操作人</nobr></th> <th><nobr>操作</nobr></th> </tr> </template> <template partial=body> <td style="text-align: center">{{$index + 1}}</td> <td style="text-align: center">{{row.f_cost_name}}</td> <td style="text-align: center">{{row.f_cost_money}}</td> <td style="text-align: center">{{row.f_remarks}}</td> <td style="text-align: center">{{row.f_material_operator}}</td> <td style="text-align: center"> <button type=button name=button class="btn btn-link" @click=$parent.$parent.$parent.update(row)>修正 </button> <button type=button name=button class="btn btn-link" @click=$parent.$parent.$parent.delete(row)>移除 </button> </td> </template> </data-grid> </criteria-paged> </div> </div> <modal :show.sync=modifyshow backdrop=false> <header slot=modal-header class=modal-header> <h4 class=modal-title>新增成本项</h4> </header> <article slot=modal-body class=modal-body> <form class=form-horizontal> <div class=form-group> <label for=f_cost_name class=control-label>成本项</label> <input type=text class="form-control col-sm-2" v-model=model.f_cost_name placeholder=成本项> </div> <div class=form-group> <label for=f_cost_money class=control-label>成本金额</label> <input type=text class=form-control v-model=model.f_cost_money placeholder=成本金额> </div> <div class=form-group> <label for=f_remarks class=control-label>备注</label> <input type=text class=form-control v-model=model.f_remarks placeholder=备注> </div> </form> </article> <footer slot=modal-footer class=modal-footer> <button type=button class="btn btn-success" @click=modifyConfirm>确认</button> <button type=button class="btn btn-default" @click=modifyclose>取消</button> </footer> </modal> <modal :show.sync=updateshow backdrop=false> <header slot=modal-header class=modal-header> <h4 class=modal-title>新增成本项</h4> </header> <article slot=modal-body class=modal-body> <form class=form-horizontal> <div class=form-group> <label for=f_cost_name class=control-label>成本项</label> <input type=text class="form-control col-sm-2" v-model=updaterow.f_cost_name placeholder=成本项> </div> <div class=form-group> <label for=f_cost_money class=control-label>成本金额</label> <input type=text class=form-control v-model=updaterow.f_cost_money placeholder=成本金额> </div> <div class=form-group> <label for=f_remarks class=control-label>备注</label> <input type=text class=form-control v-model=updaterow.f_remarks placeholder=备注> </div> </form> </article> <footer slot=modal-footer class=modal-footer> <button type=button class="btn btn-success" @click=updateConfirm>确认</button> <button type=button class="btn btn-default" @click=updateclose>取消</button> </footer> </modal> </div> '},1041:function(t,e,o){var r,s,a={};r=o(410),s=o(832),t.exports=r||{},t.exports.__esModule&&(t.exports=t.exports.default);var n="function"==typeof t.exports?t.exports.options||(t.exports.options={}):t.exports;s&&(n.template=s),n.computed||(n.computed={}),Object.keys(a).forEach(function(t){var e=a[t];n.computed[t]=function(){return e}})}});
//# sourceMappingURL=77.js.map