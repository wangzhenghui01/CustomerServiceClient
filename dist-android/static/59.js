webpackJsonp([59],{383:function(t,e,s){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=s(11),n=a(i),o=s(2),d=a(o),l=s(6),r=a(l),u=s(7),h=a(u),c=s(1),f=a(c),b=s(3);e.default={title:"报建流程业务控制层",props:["selectdata"],data:function(){return{data:null,json_datas:null,showview:!1,show_data:null,department_search:null}},methods:{special:function(){function t(t){return e.apply(this,arguments)}var e=(0,h.default)(d.default.mark(function t(e){var s,a,i,n;return d.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.data.distribute_async||"下发"!==e.button.button_name){t.next=6;break}return s=new b.HttpResetClass,t.next=4,s.load("POST","rs/logic/syncprocess",{data:{model:e,loginUser:this.$login.f}},{resolveMsg:null,rejectMsg:"流程异步下发据保存失败"});case 4:a=t.sent,console.log("流程的异步处理：",(0,r.default)(a.data));case 6:if(!this.data.distribute_async||"完成"!==e.button.button_name){t.next=12;break}return i=new b.HttpResetClass,t.next=10,i.load("POST","rs/logic/stoprocess",{data:{model:e,loginUser:this.$login.f}},{resolveMsg:null,rejectMsg:"流程异步完成数据保存失败"});case 10:n=t.sent,console.log("流程的异步处理：",(0,r.default)(n.data));case 12:case"end":return t.stop()}},t,this)}));return t}(),refurbish:function(){this.json_datas=this.$workflow_vue;for(var t=0,e={},s=0;s<this.json_datas.activitys.length;s++)this.selectdata.defname==this.json_datas.activitys[s].title&&(e=this.json_datas.activitys[s],t++);1==t?(this.data=null,this.data=e,this.initializtion()):0==t?this.$showMessage("没有在JSON配置文件中找到活动名为:("+this.selectdata.defname+")的节点配置"):this.$showMessage("在JSON配置文件中找到活动名为:("+this.selectdata.defname+")的节点配置:"+t+"个")},initializtion:function(){function t(){return e.apply(this,arguments)}var e=(0,h.default)(d.default.mark(function t(){var e,s,a,i,o,l,u,h,c,p,_;return d.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.selectdata.actorexpression){t.next=10;break}return e=new b.HttpResetClass,t.next=4,e.load("POST","rs/search",this.selectdata.actorexpression,{resolveMsg:null,rejectMsg:"search查询部门下所有人失败"});case 4:s=t.sent,console.log("search查询部门下所有人:",(0,r.default)(s.data)),a=(0,r.default)(s.data),i=[],a.startsWith("{")&&(i.push(s.data),s.data=i),this.department_search=s.data;case 10:for(this.data=(0,n.default)({},this.data,this.selectdata),o=0;o<this.data.fields.length;o++)this.selectdata[this.data.fields[o].field]&&(this.data.fields[o].value=this.selectdata[this.data.fields[o].field]),"select"===this.data.fields[o].type&&(this.data.fields[o].options=f.default.$appdata.getParam(this.data.fields[o].label));for(l=0;l<this.data.buttons.length;l++)if(this.data.buttons[l].button_fields)for(u=0;u<this.data.buttons[l].button_fields.length;u++)if(this.selectdata[this.data.buttons[l].button_fields[u].field]&&(this.data.buttons[l].button_fields[u].value=this.selectdata[this.data.buttons[l].button_fields[u].field]),"select"===this.data.buttons[l].button_fields[u].type&&this.$appdata.getParam(this.data.buttons[l].button_fields[u].label)&&(this.data.buttons[l].button_fields[u].options=this.$appdata.getParam(this.data.buttons[l].button_fields[u].label)),"下发"===this.data.buttons[l].button_name)if(1===this.data.buttons[l].button_fields.length){if(this.selectdata[this.data.buttons[l].button_fields[0].field])for(h=0;h<this.department_search.length;h++)Number(this.department_search[h].id)===Number(this.selectdata[this.data.buttons[l].button_fields[0].field])&&(this.data.buttons[l].button_fields[0].value=this.department_search[h].name);if(this.department_search){for(c=[],p=0;p<this.department_search.length;p++)c.push({label:this.department_search[p].name,value:this.department_search[p].name});this.data.buttons[l].button_fields[0].options=c}}else this.$showMessage("下发按钮必须满足 当且仅当一个字段");_=JSON.parse((0,r.default)(this.data)),this.selectdata.f_back_reason&&(_.back_reason=this.selectdata.f_back_reason),this.show_data=_,this.showview=!0;case 17:case"end":return t.stop()}},t,this)}));return t}()},events:{select_cascade:function(t){},button:function(){function t(t){return e.apply(this,arguments)}var e=(0,h.default)(d.default.mark(function t(e){var s,a,i,o;return d.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("重置"!==e.button.button_name){t.next=3;break}return this.initializtion(),t.abrupt("return");case 3:if("下发"===e.button.button_name)for(s=e.button.button_fields[this.show_data.buttons[e.button.button_index].button_fields[0].field],a=0;a<this.department_search.length;a++)this.department_search[a].name===s&&(e.button.button_fields[this.show_data.buttons[e.button.button_index].button_fields[0].field]=this.department_search[a].id);return console.log("button事件接收参数：",e),e=(0,n.default)({},this.selectdata,e),i=new b.HttpResetClass,t.next=9,i.load("POST","rs/logic/ApplyProductService",{data:{tables:this.data.tables,start_activity:this.$workflow_vue.start_activity,model:e,loginUser:this.$login.f}},{resolveMsg:null,rejectMsg:"数据保存失败"});case 9:if(o=t.sent,console.log("service处理完成返回数据：",(0,r.default)(o.data)),!(o.code=200)){t.next=18;break}this.showview=!1,this.special(e),this.$dispatch("close"),this.initializtion(),t.next=19;break;case 18:throw o.data.msg;case 19:case"end":return t.stop()}},t,this)}));return t}()},watch:{selectdata:function(){this.refurbish()},deep:!0}}},755:function(t,e){t.exports=" <service-view v-ref:service_show :data=show_data v-if=showview></service-view> "},934:function(t,e,s){var a,i,n={};a=s(383),i=s(755),t.exports=a||{},t.exports.__esModule&&(t.exports=t.exports.default);var o="function"==typeof t.exports?t.exports.options||(t.exports.options={}):t.exports;i&&(o.template=i),o.computed||(o.computed={}),Object.keys(n).forEach(function(t){var e=n[t];o.computed[t]=function(){return e}})}});
//# sourceMappingURL=59.js.map