webpackJsonp([63],{368:function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(7),l=s(o),i=a(2),d=s(i),n=a(3),f=a(129),r=s(f);d.default.mark(function e(t,a){return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.f_actualfee_type=a.f_actualfee_type[0],a.f_bill_type=a.f_bill_type[0],e.next=4,t.$resetpost("rs/logic/saveentity",{data:{tablename:"t_apply",parameters:a}});case 4:delete a.id,t.$resetpost("rs/logic/saveentity",{data:{tablename:"t_record",parameters:a}}).then(function(){t.reset()});case 6:case"end":return e.stop()}},e,this)});t.default={components:{InputAndSelect:r.default},title:"报装收费",data:function(){return{showpay:!1,addItem:null,model:{subcost:0,f_total_cost:0,f_payfee_operator:"",f_payfee_department:"",f_filiale:"",f_payfee_date:"",f_total_fee:"",rows:[]}}},props:["infee"],ready:function(){this.load(),this.model.f_payfee_operator=this.$login.f.name,this.model.f_payfee_department=this.$login.f.f_parentname,this.model.f_filiale=this.$login.f.f_fengongsi,this.model.f_payfee_date=this.$login.toStandardDateString()},methods:{check:function(){var e=/^[+-]?\d+(\.\d+)?$/;return!!e.test(this.addItem.f_fee)||(this.$showMessage("请输入数字"),this.addItem.f_fee="",!1)},change:function(){"开户费"===this.addItem.f_payfee_remarks&&(this.addItem.f_fee=this.infee.f_account_cost?this.infee.f_account_cost:0),"入户安装费"===this.addItem.f_payfee_remarks&&(this.addItem.f_fee=this.infee.f_construction_cost?this.infee.f_construction_cost:0),"材料费"===this.addItem.f_payfee_remarks&&(this.addItem.f_fee=this.infee.f_material_cost?this.infee.f_material_cost:0),"人工费"===this.addItem.f_payfee_remarks&&(this.addItem.f_fee=this.infee.f_labor_cost?this.infee.f_labor_cost:0),"改管费"===this.addItem.f_payfee_remarks&&(this.addItem.f_fee=this.infee.f_change_pipeline_cost?this.infee.f_change_pipeline_cost:0),"设备安装费"===this.addItem.f_payfee_remarks&&(this.addItem.f_fee=this.infee.f_sbaz_cost?this.infee.f_sbaz_cost:0)},smalltoBIG:function(e){var t=["角","分"],a=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],s=[["元","万","亿"],["","拾","佰","仟"]],o=e<0?"欠":"";e=Math.abs(e);for(var l="",i=0;i<t.length;i++)l+=(a[Math.floor(10*e*Math.pow(10,i))%10]+t[i]).replace(/零./,"");l=l||"整",e=Math.floor(e);for(var i=0;i<s[0].length&&e>0;i++){for(var d="",n=0;n<s[1].length&&e>0;n++)d=a[e%10]+s[1][n]+d,e=Math.floor(e/10);l=d.replace(/(零.)*零$/,"").replace(/^$/,"零")+s[0][i]+l}return o+l.replace(/(零.)*零元/,"元").replace(/(零.)+/g,"零").replace(/^整$/,"零元整")},add:function(){this.addItem=null,this.showpay=!0},close:function(){this.showpay=!1,this.addItem=null},confirm:function(){function e(){return t.apply(this,arguments)}var t=(0,l.default)(d.default.mark(function e(){var t,a,s,o=this;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.check()){e.next=3;break}return e.abrupt("return");case 3:if(a=new n.HttpResetClass,!this.addItem.f_payfee_way||!this.addItem.f_fee){e.next=18;break}return this.addItem.f_payfee_way="[]"==this.addItem.f_payfee_way?"":this.addItem.f_payfee_way[0],this.addItem.processid=this.infee.f_process_id,this.addItem.applyid=this.infee.f_apply_num,this.addItem.f_operator=this.$login.f.name,this.addItem.f_department=this.$login.f.f_parentname,this.addItem.f_filiale=this.$login.f.f_fengongsi,this.addItem.f_fee=Number(this.addItem.f_fee),this.addItem.f_charging_item="",this.addItem.f_pay_number="",this.model.rows.push(this.addItem),s={tablename:"t_paydetail",parameters:this.addItem},e.next=18,a.load("POST","rs/logic/saveentity",{data:s},{resolveMsg:null,rejectMsg:"添加失败"}).then(function(e){o.close()});case 18:case"end":return e.stop()}},e,this)}));return e}(),load:function(){function e(){return t.apply(this,arguments)}var t=(0,l.default)(d.default.mark(function e(){var t,a,s,o;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new n.HttpResetClass,a={columnname:"f_contract_money",tablename:"t_contract",condition:"processid = '"+this.infee.f_process_id+"'"},e.next=4,t.load("POST","rs/sql/getSum",{data:a},{resolveMsg:null,rejectMsg:"获取总金额失败"});case 4:return s=e.sent,this.model.f_total_cost=s.data[0].f_contract_money,a={tablename:"t_paydetail",condition:"processid = '"+this.infee.f_process_id+"'"},e.next=9,t.load("POST","rs/sql/singleTable",{data:a},{resolveMsg:null,rejectMsg:"获取付款数据失败"});case 9:for(s=e.sent,o=0;o<s.data.length;o++)s.data[o].f_payfeedate=s.data[o].f_payfeedate.substring(0,11);this.model.rows=s.data;case 12:case"end":return e.stop()}},e,this)}));return e}()},computed:{getCapital:function(){return this.addItem.f_fee&&(this.addItem.f_capital=this.smalltoBIG(Number(this.addItem.f_fee))),this.addItem.f_capital},subcost:function(){for(var e=Number(this.model.f_total_cost),t=0,a=0;a<this.model.rows.length;a++)t+=Number(this.model.rows[a].f_fee);return this.model.f_total_fee=Math.round(100*t)/100,this.model.subcost=Math.round(100*(e-t))/100,this.model.f_total_fee&&this.model.f_jmhj_cost&&(e=Math.round(100*(e-Number(this.model.f_jmhj_cost)))/100),this.model.subcost=Math.round(100*(e-t))/100,this.model.subcost},aaa:function(){return this.model.f_jmhj_cost=Number(this.model.f_total_cost)-Number(this.model.f_actualfee),this.model.f_jmhj_cost},feeoptions:function(){return this.$appdata.getParam("费用类型")},dayin:function(){return this.$appdata.getParam("打印格式")},jiaofei:function(){return this.$appdata.getParam("缴费类型")}}}},744:function(e,t){e.exports=' <div class="col-sm-12 auto select-overspread"> <div class="auto select-overspread"> <div class="panel panel-info"> <div class="panel-heading auto"> <h3 class=panel-title>报装收费</h3> </div> </div> </div> <div class=col-sm-12> <span class=col-sm-3 v-show="!($login.f.f_fengongsi.includes(\'彩虹\')||$login.f.f_fengongsi.includes(\'中燃\'))">合同编号:{{infee.f_contract_number}}</span> <span class=col-sm-2 v-show="!($login.f.f_fengongsi.includes(\'彩虹\')||$login.f.f_fengongsi.includes(\'中燃\'))">合同总金额:{{model.f_total_cost}}元</span> <span class=col-sm-2 v-show=model.f_jmhj_cost>优惠金额:{{model.f_jmhj_cost}}元</span> <span class=col-sm-2 v-show="!($login.f.f_fengongsi.includes(\'彩虹\'))">累计缴费金额:{{model.f_total_fee}}元</span> <span class=col-sm-2 v-show="!($login.f.f_fengongsi.includes(\'彩虹\')||$login.f.f_fengongsi.includes(\'中燃\'))">未结:{{subcost}}元</span> <button type=button class="btn btn-warning col-sm-2" @click=add()>新增收费</button> </div> <div class=col-sm-12 style="height: auto"> <div class="form-inline auto" style="margin-bottom: 5px"> </div> <div class="col-sm-12 span recordTable" style="margin-top: 10px;min-height: 500px"> <partial-view v-ref:single-load> <data-grid :model=model v-ref:grid> <template partial=head> <tr> <th>序号</th> <th>金额(元)</th> <th>金额大写</th> <th>缴费类型</th> <th>收费人员</th> <th>日期</th> <th>备注</th> </tr> </template> <template partial=body> <td style="text-align: center">{{$index+1}}</td> <td style="text-align: center">{{row.f_fee}}</td> <td style="text-align: center">{{row.f_capital}}</td> <td style="text-align: center">{{row.f_payfee_way}}</td> <td style="text-align: center">{{row.f_operator}}</td> <td style="text-align: center">{{row.f_payfeedate}}</td> <td style="text-align: center">{{row.f_payfee_remarks}}</td> </template> </data-grid> </partial-view> </div> </div> <div class="form-group col-sm-12"> <div class=col-sm-6> <label class="control-label col-sm-4">分公司：</label> <div class=col-sm-8> <input class=form-control type=text v-model=model.f_filiale disabled=disabled> </div> </div> <div class=col-sm-6> <label class="control-label col-sm-4">操作日期：</label> <div class=col-sm-8> <input class=form-control type=text v-model=model.f_payfee_date disabled=disabled> </div> </div> </div> <div class="form-group col-sm-12"> <div class=col-sm-6> <label class="control-label col-sm-4">部门：</label> <div class=col-sm-8> <input class=form-control type=text v-model=model.f_payfee_department disabled=disabled> </div> </div> <div class=col-sm-6> <label class="control-label col-sm-4">操作人：</label> <div class=col-sm-8> <input class=form-control type=text v-model=model.f_payfee_operator disabled=disabled> </div> </div> </div> <modal :show.sync=showpay v-ref:modal backdrop=false> <header slot=modal-header class=modal-header> <button type=button class=close @click=close><span>&times;</span></button> <h4 class=modal-title>新增收费</h4> </header> <article slot=modal-body class=modal-body> <div v-if=showpay> <div class=from-group> <label>金额(元)</label> <input type=text class=form-control v-model=addItem.f_fee @blur=check()> </div> <div class=from-group> <label>金额大写</label> <input type=text class=form-control v-model=getCapital readonly=readonly> </div> <div class=from-group> <label>缴费类型</label> <v-select :options=jiaofei v-model=addItem.f_payfee_way :value.sync=addItem.f_payfee_way close-on-select> </v-select> </div> <div class=from-group> <label>交费日期</label> <div> <datepicker width=600.76px; :value.sync=addItem.f_payfeedate :format="\'yyyy-MM-dd\'" v-model=addItem.f_payfeedate readonly=readonly :show-reset-button=reset> </datepicker> </div> </div> <div class=from-group> <label>备注</label> <input-select :value.sync=addItem.f_payfee_remarks v-model=addItem.f_payfee_remarks :options=feeoptions @change=change close-on-select></input-select> </div> </div> </article> <footer slot=modal-footer class=modal-footer> <button v-show=showpay type=button class="btn btn-default" @click=close>取消</button> <button v-show=showpay type=button class="btn btn-success" @click=confirm>确认</button> </footer> </modal> </div> '},919:function(e,t,a){var s,o,l={};s=a(368),o=a(744),e.exports=s||{},e.exports.__esModule&&(e.exports=e.exports.default);var i="function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports;o&&(i.template=o),i.computed||(i.computed={}),Object.keys(l).forEach(function(e){var t=l[e];i.computed[e]=function(){return t}})}});
//# sourceMappingURL=63.js.map