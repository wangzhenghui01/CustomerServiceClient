{"version":3,"sources":["webpack:///64.js","webpack:///ApplyRecordCancel.vue","webpack:///./src/components/product/Function/functions/ApplyRecordCancel.vue?cd8b","webpack:///./src/components/product/Function/functions/ApplyRecordCancel.vue"],"names":["webpackJsonp","367","module","exports","__webpack_require__","_interopRequireDefault","obj","__esModule","default","Object","defineProperty","value","_regenerator","_regenerator2","_asyncToGenerator2","_asyncToGenerator3","postGen","_ref","mark","_callee","self","name","url","getRecord","getEticket","wrap","_context","prev","next","$CancelService","cancel","model","data","sent","console","log","isNeedEticket","type","id","$resetpost","tablename","condition","resolveMsg","rejectMsg","length","$CommonService","correctEticket","$dispatch","stop","this","_x","_x2","apply","arguments","props","title","f_cancel_reason","f_cancel_name","$login","f","f_filiale","f_fengongsi","f_outlets","f_parentname","f_orgstr","orgpathstr","f_filialeids","f_orgids","record_id","methods","confirm","sortdata","post","clean","record","f_cardfees","f_collection","743","918","__vue_script__","__vue_template__","__vue_styles__","__vue_options__","options","template","computed","keys","forEach","key"],"mappings":"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","file":"64.js","sourcesContent":["webpackJsonp([64],{\n\n/***/ 367:\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _regenerator = __webpack_require__(2);\n\t\n\tvar _regenerator2 = _interopRequireDefault(_regenerator);\n\t\n\tvar _asyncToGenerator2 = __webpack_require__(7);\n\t\n\tvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tvar postGen = function () {\n\t  var _ref = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee(self, name) {\n\t    var url, getRecord, getEticket;\n\t    return _regenerator2.default.wrap(function _callee$(_context) {\n\t      while (1) {\n\t        switch (_context.prev = _context.next) {\n\t          case 0:\n\t            url = 'rs/logic/' + name;\n\t            _context.next = 3;\n\t            return self.$CancelService.cancel(url, self.model, self.data);\n\t\n\t          case 3:\n\t            getRecord = _context.sent;\n\t\n\t            console.log('冲正后的记录。。', getRecord);\n\t\n\t            if (!self.isNeedEticket(getRecord.data, self.data.type)) {\n\t              _context.next = 14;\n\t              break;\n\t            }\n\t\n\t            console.log('冲正打票，', getRecord.data.id, self.data.type);\n\t            _context.next = 9;\n\t            return self.$resetpost('rs/sql/singleTable', {\n\t              data: {\n\t                tablename: 't_eticket',\n\t                condition: 'f_sell_id = \\'' + getRecord.data.id + '\\' and f_charge_type = \\'' + self.data.type + '\\''\n\t              }\n\t            }, { resolveMsg: null, rejectMsg: '获取电子票明细失败!!' });\n\t\n\t          case 9:\n\t            getEticket = _context.sent;\n\t\n\t            console.log('获取电子票信息', getEticket);\n\t\n\t            if (!(getEticket.data.length > 0)) {\n\t              _context.next = 14;\n\t              break;\n\t            }\n\t\n\t            _context.next = 14;\n\t            return self.$CommonService.correctEticket(getRecord.data.id, self.data.type);\n\t\n\t          case 14:\n\t            self.$dispatch('success');\n\t\n\t          case 15:\n\t          case 'end':\n\t            return _context.stop();\n\t        }\n\t      }\n\t    }, _callee, this);\n\t  }));\n\t\n\t  return function postGen(_x, _x2) {\n\t    return _ref.apply(this, arguments);\n\t  };\n\t}();\n\t\n\texports.default = {\n\t  props: ['data'],\n\t  title: '操作撤销',\n\t  data: function data() {\n\t    return {\n\t      model: {\n\t        f_cancel_reason: '',\n\t        f_cancel_name: this.$login.f.name,\n\t        f_filiale: this.$login.f.f_fengongsi,\n\t        f_outlets: this.$login.f.f_parentname,\n\t        f_orgstr: this.$login.f.orgpathstr,\n\t        f_filialeids: this.$login.f.f_orgids,\n\t        record_id: ''\n\t      }\n\t    };\n\t  },\n\t\n\t  methods: {\n\t    confirm: function confirm() {\n\t      var name = this.sortdata();\n\t      console.log('撤销请求业务逻辑名', name);\n\t\n\t      console.log(name);\n\t      this.post(name);\n\t      this.$dispatch('searchcard');\n\t      this.$dispatch('hiddenbtn');\n\t    },\n\t    clean: function clean() {\n\t      this.$dispatch('clean', this.model);\n\t      this.$dispatch('searchcard');\n\t      this.$dispatch('hiddenbtn');\n\t    },\n\t    sortdata: function sortdata() {\n\t      this.model.record_id = this.data.id;\n\t      var type = this.data.type;\n\t      var name = void 0;\n\t\n\t      if (type === '过户') {\n\t        name = 'transferCancel';\n\t      } else if (type === '换表') {\n\t        name = 'changemeterCancel';\n\t      } else if (type === '机表收费') {\n\t        name = 'machineChargeCancelPay';\n\t      } else if (type === '物联网收费') {\n\t        name = 'iotMeterChargeCancel';\n\t      } else if (type === '卡表超用') {\n\t        name = 'cardOverCancel';\n\t      } else if (type === '超用收费') {\n\t        name = 'overuseCancel';\n\t      } else if (type === '其他收费') {\n\t        name = 'otherFeeRollback';\n\t      } else if (type === '补卡') {\n\t        name = 'replaceCardCancel';\n\t      } else if (type === '终止报建') {\n\t        name = 'CancelStopApply';\n\t      } else {\n\t        return;\n\t      }\n\t      return name;\n\t    },\n\t    post: function post(name) {\n\t      postGen(this, name);\n\t    },\n\t    isNeedEticket: function isNeedEticket(record, type) {\n\t      if (type === '补卡') {\n\t        if (record.f_cardfees > 0) {\n\t          return true;\n\t        }\n\t      } else if (type === '其他收费') {\n\t        if (record.f_collection > 0) {\n\t          return true;\n\t        }\n\t      } else if (type === '超用收费') {\n\t        if (record.f_collection > 0) {\n\t          return true;\n\t        }\n\t      } else if (type === '物联网表收费') {\n\t        if (record.f_collection > 0) {\n\t          return true;\n\t        }\n\t      }\n\t      return false;\n\t    }\n\t  }\n\t};\n\n/***/ }),\n\n/***/ 743:\n/***/ (function(module, exports) {\n\n\tmodule.exports = \" <div class=auto> <validator name=v> <p class=\\\"bg-info text-center\\\" style=\\\"padding: 8px\\\">{{data.type}}撤销</p> <div class=row style=margin-top:10px> <div class=form-group> <label for=f_cancel_reason class=\\\"col-sm-2 control-label\\\">撤销原因:</label> <div class=col-sm-8> <textarea class=form-control v-model=model.f_cancel_reason rows=3 placeholder=请填写原因></textarea> </div> </div> </div> <div style=text-align:right;height:auto;margin-top:30px;margin-right:50px> <button class=\\\"btn btn-success\\\" @click=confirm()>确&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;认</button> <button class=\\\"btn btn-default\\\" @click=clean() style=width:80px;margin-left:20px>取&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;消</button> </div> </validator> </div> \";\n\n/***/ }),\n\n/***/ 918:\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar __vue_script__, __vue_template__\n\tvar __vue_styles__ = {}\n\t__vue_script__ = __webpack_require__(367)\n\t__vue_template__ = __webpack_require__(743)\n\tmodule.exports = __vue_script__ || {}\n\tif (module.exports.__esModule) module.exports = module.exports.default\n\tvar __vue_options__ = typeof module.exports === \"function\" ? (module.exports.options || (module.exports.options = {})) : module.exports\n\tif (__vue_template__) {\n\t__vue_options__.template = __vue_template__\n\t}\n\tif (!__vue_options__.computed) __vue_options__.computed = {}\n\tObject.keys(__vue_styles__).forEach(function (key) {\n\tvar module = __vue_styles__[key]\n\t__vue_options__.computed[key] = function () { return module }\n\t})\n\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// 64.js","<template>\r\n  <div class=\"auto\">\r\n    <validator name='v'>\r\n      <p class=\"bg-info text-center\" style=\"padding: 8px;\">{{data.type}}撤销</p>\r\n      <div class=\"row\" style=\"margin-top:10px;\">\r\n        <div class=\"form-group\">\r\n          <label for=\"f_cancel_reason\" class=\" col-sm-2 control-label\">撤销原因:</label>\r\n          <div class=\"col-sm-8\">\r\n            <textarea class=\"form-control\" v-model=\"model.f_cancel_reason\" rows=\"3\" placeholder=\"请填写原因\"></textarea>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div style=\"text-align:right;height:auto;margin-top:30px;margin-right:50px;\">\r\n        <button class=\"btn btn-success\" @click=\"confirm()\" >确&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;认</button>\r\n        <button class=\"btn btn-default\" @click=\"clean()\" style=\"width:80px;margin-left:20px;\">取&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;消</button>\r\n      </div>\r\n    </validator>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n\r\n  let postGen = async function (self, name) {\r\n    let url = 'rs/logic/' + name\r\n    // 获取冲正后的记录\r\n    let getRecord = await self.$CancelService.cancel(url, self.model, self.data)\r\n    console.log('冲正后的记录。。', getRecord)\r\n    // 判断需不需要打印电子票\r\n    if (self.isNeedEticket(getRecord.data, self.data.type)) {\r\n      console.log('冲正打票，', getRecord.data.id, self.data.type)\r\n      let getEticket = await\r\n        self.$resetpost('rs/sql/singleTable', {\r\n          data: {\r\n            tablename: 't_eticket',\r\n            condition: `f_sell_id = '${getRecord.data.id}' and f_charge_type = '${self.data.type}'`\r\n          }\r\n        }, {resolveMsg: null, rejectMsg: '获取电子票明细失败!!'})\r\n      console.log('获取电子票信息', getEticket)\r\n      if (getEticket.data.length > 0) {\r\n        await self.$CommonService.correctEticket(getRecord.data.id, self.data.type)\r\n      }\r\n    }\r\n    self.$dispatch('success')\r\n  }\r\n\r\n  export default {\r\n    props: ['data'],\r\n    title: '操作撤销',\r\n    data () {\r\n      return {\r\n        model: {\r\n          f_cancel_reason: '',\r\n          f_cancel_name: this.$login.f.name,\r\n          f_filiale:this.$login.f.f_fengongsi,\r\n          f_outlets:this.$login.f.f_parentname,\r\n          f_orgstr:this.$login.f.orgpathstr,\r\n          f_filialeids:this.$login.f.f_orgids,\r\n          record_id: ''\r\n        }\r\n      }\r\n    },\r\n    methods: {\r\n      confirm () {\r\n        // 整理数据\r\n        let name = this.sortdata()\r\n        console.log('撤销请求业务逻辑名',  name)\r\n        // 撤销操作请求\r\n        console.log(name)\r\n        this.post(name)\r\n        this.$dispatch('searchcard')\r\n        this.$dispatch('hiddenbtn')\r\n      },\r\n      clean () {\r\n        this.$dispatch('clean', this.model)\r\n        this.$dispatch('searchcard')\r\n        this.$dispatch('hiddenbtn')\r\n      },\r\n      // 判断type类型  整理数据\r\n      sortdata () {\r\n        this.model.record_id = this.data.id\r\n        let type = this.data.type\r\n        let name\r\n        // 根据type数据 选择调用的Logic\r\n        if (type === '过户') {\r\n          name = 'transferCancel'\r\n        } else if (type === '换表') {\r\n          name = 'changemeterCancel'\r\n        } else if (type === '机表收费') {\r\n          name = 'machineChargeCancelPay'\r\n        } else if (type === '物联网收费') {\r\n          name = 'iotMeterChargeCancel'\r\n        } else if (type === '卡表超用') {\r\n          name = 'cardOverCancel'\r\n        } else if (type === '超用收费') {\r\n          name = 'overuseCancel'\r\n        } else if (type === '其他收费') {\r\n          name = 'otherFeeRollback'\r\n        } else if (type === '补卡') {\r\n          name = 'replaceCardCancel'\r\n        } else if (type === '终止报建'){\r\n          name = 'CancelStopApply'\r\n        }else{\r\n          return\r\n        }\r\n        return name\r\n      },\r\n      // 发送请求  及 请求后处理页面\r\n      post (name) {\r\n        postGen(this, name)\r\n      },\r\n      isNeedEticket (record, type) {\r\n        // TODO 需要其他类型再继续加\r\n        if (type === '补卡') {\r\n          // 判断卡费是否大于零\r\n          if (record.f_cardfees > 0) {\r\n            return true\r\n          }\r\n        } else if (type === '其他收费') {\r\n          if (record.f_collection > 0) {\r\n            return true\r\n          }\r\n        } else if (type === '超用收费') {\r\n          if (record.f_collection > 0) {\r\n            return true\r\n          }\r\n        } else if (type === '物联网表收费') {\r\n          if (record.f_collection > 0) {\r\n            return true\r\n          }\r\n        }\r\n        return false\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\n\n\n// WEBPACK FOOTER //\n// ApplyRecordCancel.vue?006dc770","module.exports = \" <div class=auto> <validator name=v> <p class=\\\"bg-info text-center\\\" style=\\\"padding: 8px\\\">{{data.type}}撤销</p> <div class=row style=margin-top:10px> <div class=form-group> <label for=f_cancel_reason class=\\\"col-sm-2 control-label\\\">撤销原因:</label> <div class=col-sm-8> <textarea class=form-control v-model=model.f_cancel_reason rows=3 placeholder=请填写原因></textarea> </div> </div> </div> <div style=text-align:right;height:auto;margin-top:30px;margin-right:50px> <button class=\\\"btn btn-success\\\" @click=confirm()>确&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;认</button> <button class=\\\"btn btn-default\\\" @click=clean() style=width:80px;margin-left:20px>取&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;消</button> </div> </validator> </div> \";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/vue-html-loader!./~/vue-loader/lib/selector.js?type=template&index=0!./src/components/product/Function/functions/ApplyRecordCancel.vue\n// module id = 743\n// module chunks = 64","var __vue_script__, __vue_template__\nvar __vue_styles__ = {}\n__vue_script__ = require(\"!!babel-loader?presets[]=es2015&plugins[]=transform-runtime&comments=false!../../../../../node_modules/vue-loader/lib/selector.js?type=script&index=0!./ApplyRecordCancel.vue\")\n__vue_template__ = require(\"!!vue-html-loader!../../../../../node_modules/vue-loader/lib/selector.js?type=template&index=0!./ApplyRecordCancel.vue\")\nmodule.exports = __vue_script__ || {}\nif (module.exports.__esModule) module.exports = module.exports.default\nvar __vue_options__ = typeof module.exports === \"function\" ? (module.exports.options || (module.exports.options = {})) : module.exports\nif (__vue_template__) {\n__vue_options__.template = __vue_template__\n}\nif (!__vue_options__.computed) __vue_options__.computed = {}\nObject.keys(__vue_styles__).forEach(function (key) {\nvar module = __vue_styles__[key]\n__vue_options__.computed[key] = function () { return module }\n})\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/product/Function/functions/ApplyRecordCancel.vue\n// module id = 918\n// module chunks = 64"],"sourceRoot":""}