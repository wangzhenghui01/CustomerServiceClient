webpackJsonp([28],{377:function(n,e,t){"use strict";function s(n){return n&&n.__esModule?n:{default:n}}Object.defineProperty(e,"__esModule",{value:!0});var a=t(45),o=s(a),i=t(11),r=s(i),l=t(148),d=s(l),c=t(2),u=s(c),f=t(7),h=s(f),p=t(3),m=t(1),b=s(m),v=function(){var n=(0,h.default)(u.default.mark(function n(e){return u.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("获取登录信息，",e.$login,e.$appdata,e.$appdata.getParam("用户类型"),b.default.$login.f.name),e.headers.username=b.default.$login.f.name,e.headers.username=b.default.$login.guid(),n.next=5,e.search();case 5:return n.next=7,e.$ApplyLoadParams.loadParam();case 7:e.initAdjustables();case 8:case"end":return n.stop()}},n,this)}));return function(e){return n.apply(this,arguments)}}();e.default={title:"用户档案",data:function(){return{model:new p.PagedList("rs/sql/singleTable_OrderBy",30,{items:'"*"',tablename:'"t_userinfo"',orderitem:'"CONVERT(int,f_userinfo_id)  desc"'}),row:null,arearow:null,areainfo:null,rows:[],newArea:!1,nonUser:!1,modify:!1,batcan:!1,batenable:!1,show:!1,showaccept:!1,headers:{username:this.$login.f.name,blodid:this.$login.guid()},contract:[{label:"全部",value:" is null or f_contract_id is not null"},{label:"有",value:" is not null"},{label:"无",value:" is null"}],orderDefault:"f_createfile_date desc",orderFields:{f_userinfo_id:"no"},inputtores:this.$appdata.getParam("抄表员"),adjustables:[]}},ready:function(){v(this)},methods:{addAccept:function(){this.showaccept=!0,this.newArea=!1,this.batcan=!1,this.batenable=!1,this.nonUser=!1,this.modify=!1,this.row=null,this.areainfo=null},search:function(){this.$refs.paged.$refs.criteria.search()},modifyinfo:function(n){this.$parent.show=!0,this.$parent.$refs.queryuser.addactive(n)},clean:function(){this.newArea=!1,this.batcan=!1,this.batenable=!1,this.nonUser=!1,this.modify=!1,this.row=null,this.areainfo=null,this.showaccept=!1,this.$refs.paged.$refs.grid.select(null),this.$refs.paged.$refs.grid.model.rows=this.rows},renew:function(){this.nonUser=!1,this.modify=!1,this.newArea=!1,this.showaccept=!1,this.row=null,this.areainfo=null,this.clearCondition(),this.search(),this.$refs.addressfiles.$refs.paged.$refs.cri.search()},clearCondition:function(){var n=this;console.log("清空条件。。",this.$refs.paged),(0,d.default)(this.$refs.paged.$refs.criteria.model).forEach(function(e){n.$refs.paged.$refs.criteria.model[e]=""})},buildFile:function(n){this.row=n,this.modify=!1,this.nonUser=!1,this.newArea=!1,this.showaccept=!1},selected:function(n){this.nonUser=!1,this.modify=!1,this.arearow=n.val,this.areainfo=null,this.newArea=!0,this.showaccept=!1,this.row=null,this.$refs.paged.$refs.grid.model.rows=this.rows},bulidFiles:function(n){console.log("k开始建档"),this.arearow=null,this.newArea=!1,this.nonUser=!1,this.modify=!1,this.showaccept=!1,this.row=null,this.areainfo=n,this.$refs.paged.$refs.grid.model.rows=this.rows},addNoUser:function(n){console.log("建非民用row",n),this.arearow=null,this.newArea=!1,this.row=null,this.showaccept=!1,this.modify=!1,this.areainfo=n,this.nonUser=!0},buildFileSuccess:function(n){this.model.rows.unshift(n)},selfSearch:function(n){n.condition=n.condition+" and f_filialeids  = '"+this.$login.f.f_orgids+"'",this.model.search(n.condition,n.model)},bulkOperations:function(n,e){"批量销户"===n?(this.batcan=!0,this.batenable=!1,this.newArea=!1,this.showaccept=!1):"批量启用"===n&&(this.batenable=!0,this.batcan=!1,this.newArea=!1,this.showaccept=!1)},batchSuccess:function(){this.batenable=!1,this.batcan=!1,this.showaccept=!1,this.search()},fileUpload:function(){this.show=!0},close:function(){this.show&&(this.show=!1,this.$refs.file.$el.querySelector("input").value="")},sort:function(n,e){for(var t in this.orderFields)t===n?this.orderFields[t]=e:this.orderFields[t]="no";"no"===e?this.model.paramSource.orderitem="'"+this.orderDefault+"'":this.model.paramSource.orderitem="'"+n+" "+e+"'",this.search()},getLocation:function(n){var e=this;console.log("进入",n),n.f_useraddress_id?this.$resetpost("rs/sql/saleSingleTable",{data:{tablename:"t_userinfo",condition:"f_useraddress_id = '"+n.f_useraddress_id+"'"}},{resolveMsg:null,rejectMsg:"获取档案出错"}).then(function(n){1===n.data.length&&e.modifyUser(n.data[0])}):this.$resetpost("rs/sql/sale_getService_sql",{data:{condition:"'"+n.id+"'"}},{resolveMsg:null,rejectMsg:"查询工单信息失败"}).then(function(t){1===t.data.length?e.$showMessage("该地址下有已完成的置换通气单,是否要将通气单中的信息带入建档中?",["confirm","cancel"]).then(function(s){if("confirm"===s){var a=(0,r.default)({},n,t.data[0]);e.bulidFiles(a)}else e.bulidFiles(n)}):e.bulidFiles(n)})},areaFiles:function(n){this.bulidFiles(n)},initAdjustables:function(){console.log("初始化调压箱",this.$GetSaleParam);var n=[],e=this.$login.f.f_orgids;this.$GetSaleParam.getAdjustable(e).forEach(function(e){var t={};t.label="["+e.value.f_adjustable_id+"]-"+e.label,t.value=""+e.value.id,n.push(t)}),this.adjustables=[{label:"全部",value:""}].concat(n)}},computed:{userstates:function(){return[{label:"全部",value:""}].concat((0,o.default)(this.$appdata.getParam("用户状态")))},areas:function(){for(var n=[],e=0;e<this.$login.f.f_allArea.length;e++){var t={label:this.$login.f.f_allArea[e].label,value:this.$login.f.f_allArea[e].label};n.push(t)}return[{label:"全部",value:""}].concat(n)},firestates:function(){return[{label:"全部",value:""},{label:"点火",value:"1"},{label:"未点火",value:"0"}]},jurisdiction:function(){return this.$login.r}},watch:{"model.state":function(n){"正确"===n&&(this.rows=this.model.rows)}},events:{onFileUpload:function(n,e){var t=this,s={tablename:"t_userinfo",filepath:e.path};this.$resetpost("rs/logic/import",s,{resolveMsg:null,rejectMsg:"上传失败"}).then(function(n){console.log("dddddddd",t),t.close(),t.$showAlert("一共上传"+n.data.total+"条数据, 成功"+n.data.successnum+"条","success",2e3),t.search()})}}}},494:function(n,e,t){e=n.exports=t(4)(),e.push([n.id,".nav-tabss ul>li>a{padding:5px 10px}","",{version:3,sources:["/./src/components/product/Process/ModifyUserFiles.vue"],names:[],mappings:"AAgcA,mBACE,gBAAkB,CACnB",file:"ModifyUserFiles.vue",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.nav-tabss ul > li > a{\n  padding: 5px 10px;\n}\n"],sourceRoot:"webpack://"}])},565:function(n,e,t){var s=t(494);"string"==typeof s&&(s=[[n.id,s,""]]);t(5)(s,{});s.locals&&(n.exports=s.locals)},751:function(n,e){n.exports=' <div class=flex-row> <div style="flex: 1.5;width: 100%" class=flex id=user-files> <div class=flex> <criteria-paged :model=model v-ref:paged :pager="!row && !newArea && !areainfo" @sort=sort> <criteria partial=criteria v-ref:criteria @condition-changed=$parent.selfSearch> <div novalidate class="form-inline auto" partial> <div class=form-group> <input type=text class=form-control v-model=model.f_userinfo_code condition="f_userinfo_code=\'{}\'" placeholder=用户编号 :size="model.f_userinfo_code ? model.f_userinfo_code.length : 4"> </div> <div class=form-group> <input type=text class=form-control v-model=model.f_user_name condition="f_user_name like \'%{}%\'" placeholder=用户姓名 :size="model.f_user_name ? model.f_user_name.length * 2 : 4"> </div> <div class=form-group> <input type=text class=form-control v-model=model.f_user_phone placeholder=电话 condition="f_user_phone = \'{}\'" :size="model.f_user_phone ? model.f_user_phone.length : 2"> </div> <div class=form-group> <input type=text class=form-control v-model=model.f_residential_area condition="f_residential_area like \'%{}%\'" placeholder=小区 :size="model.f_residential_area ? model.f_residential_area.length * 2 : 4"> </div> <div class=form-group> <input type=text class=form-control v-model=model.f_address condition="f_address like \'%{}%\'" placeholder=用户地址 :size="model.f_address ? model.f_address.length * 2 : 4"> </div> <div class=form-group> <v-select :value.sync=model.f_user_state v-model=model.f_user_state :options=$parent.$parent.userstates placeholder=用户状态 close-on-select condition="f_user_state=\'{}\'"></v-select> </div> <div class=form-group> <v-select :value.sync=model.f_area v-model=model.f_area :options=$parent.$parent.areas placeholder=片区/管理站 condition="f_area like \'%{}%\'" close-on-select> </v-select> </div> <div class=form-group> <v-select :value.sync=model.f_adjustable_id :options=$parent.$parent.adjustables placeholder=调压箱 close-on-select v-model=model.f_adjustable_id condition="f_adjustable_id = \'{}\'" :search=true></v-select> </div> <div class=form-group> <button class="btn btn-success width-100" @click="search(), $parent.$parent.clean()">查询</button> </div> <div class="form-group col-sm-offset-1"> <button class="btn btn-danger width-50" @click="$parent.$parent.$parent.show = true">返回</button> </div> </div> </criteria> <data-grid :model=model v-ref:grid partial=list> <template partial=head> <tr> <th><nobr>序号</nobr></th> <th> <data-order field=f_userinfo_code name=用户编号 :order.sync=$parent.$parent.$parent.orderFields.f_userinfo_code></data-order> </th> <th><nobr>用户信息</nobr></th> <th><nobr>地址信息</nobr></th> <th><nobr>状态</nobr></th> <th><nobr>操作</nobr></th> </tr> </template> <template partial=body> <td style="text-align: center">{{$index + 1}}</td> <td>{{row.f_userinfo_code}}</td> <td>{{row.f_user_name}}&nbsp;&nbsp;{{row.f_user_phone ? row.f_user_phone : \'\'}}</td> <td>{{row.f_address_detail ? row.f_address + row.f_address_detail : row.f_address}}</td> <td style="text-align: center">{{row.f_user_state}}</td> <td style="text-align: center"> <button type=button name=button class="btn btn-link" v-if="row.f_user_state === \'正常\'" @click.stop=$parent.$parent.$parent.modifyinfo(row)>改装</button> </td> </template> </data-grid> </criteria-paged> </div> <div style="height: 500px" v-show="row || newArea || areainfo || nonUser" class=select-overspread> <user-general-info v-if="row || areainfo || nonUser" :row=row :modify=modify @clean=clean :areainfo=areainfo :non-user=nonUser @success=renew @build-success=buildFileSuccess></user-general-info> </div> <div style="height: 500px" v-if="batcan || batenable"> <batch-cancellation v-if=batcan :useraccount=model.rows @clean=clean @success=batchSuccess></batch-cancellation> <batch-enable v-if=batenable :useraccount=model.rows @clean=clean @success=batchSuccess></batch-enable> </div> </div> <modal :show.sync=show v-ref:modal backdrop=false> <header slot=modal-header class=modal-header> <button type=button class=close @click=close><span>&times;</span></button> <h4 class=modal-title>文件上传</h4> </header> <article slot=modal-body class=modal-body> <div class=form-group> <file-upload class=my-file-uploader name=myFile action=rs/file/upload tagname=文件上传 :headers=headers multiple=multiple v-ref:file></file-upload> </div> </article> <footer slot=modal-footer class=modal-footer> </footer> </modal> </div> '},928:function(n,e,t){var s,a,o={};t(565),s=t(377),a=t(751),n.exports=s||{},n.exports.__esModule&&(n.exports=n.exports.default);var i="function"==typeof n.exports?n.exports.options||(n.exports.options={}):n.exports;a&&(i.template=a),i.computed||(i.computed={}),Object.keys(o).forEach(function(n){var e=o[n];i.computed[n]=function(){return e}})}});
//# sourceMappingURL=28.js.map