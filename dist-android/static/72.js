webpackJsonp([72],{79:function(t,e,a){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=a(11),i=s(o),n=a(2),l=s(n),d=a(6),r=s(d),u=a(7),c=s(u),h=a(8),f=s(h),p=a(1),b=s(p),_=a(3);e.default={title:"报建流程业务控制层",props:["selectdata"],data:function(){return{data:null,json_datas:null,showview:!1,show_data:null,department_search:null}},methods:{special:function(){function t(t){return e.apply(this,arguments)}var e=(0,c.default)(l.default.mark(function t(e){var a,s,o,i;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("进入async special方法"),!this.data.distribute_async||"下发"!==e.button.button_name){t.next=7;break}return a=new _.HttpResetClass,t.next=5,a.load("POST",this.$androidUtil.getProxyUrl()+"/rs/logic/syncprocess",{data:{model:e,loginUser:this.$login.f}},{resolveMsg:null,rejectMsg:"流程异步下发据保存失败"});case 5:s=t.sent,console.log("流程的异步处理：",(0,r.default)(s.data));case 7:if(!this.data.distribute_async||"完成"!==e.button.button_name){t.next=13;break}return o=new _.HttpResetClass,t.next=11,o.load("POST",this.$androidUtil.getProxyUrl()+"/rs/logic/stoprocess",{data:{model:e,loginUser:this.$login.f}},{resolveMsg:null,rejectMsg:"流程异步完成数据保存失败"});case 11:i=t.sent,console.log("流程的异步处理：",(0,r.default)(i.data));case 13:case"end":return t.stop()}},t,this)}));return t}(),refurbish:function(){if(!this.$workflow_vue)return void this.$showMessage("流程配置文件不存在，请反馈系统管理员");console.log("内存中的流程配置文件数据=>"+(0,r.default)(this.$workflow_vue)),this.json_datas=this.$workflow_vue;for(var t=0,e={},a=0;a<this.json_datas.activitys.length;a++)this.selectdata.defname==this.json_datas.activitys[a].title&&(e=this.json_datas.activitys[a],t++);console.log("sum=>"+t),1==t?(this.data=null,this.data=e,console.log("调用initializtion前的this.data=>"+(0,r.default)(this.data)),this.initializtion()):0==t?this.$showMessage("没有在JSON配置文件中找到活动名为:("+this.selectdata.defname+")的节点配置"):this.$showMessage("在JSON配置文件中找到活动名为:("+this.selectdata.defname+")的节点配置:"+t+"个")},initializtion:function(){function t(){return e.apply(this,arguments)}var e=(0,c.default)(l.default.mark(function t(){var e,a,s,o,n,d,u,c,h,f,p,b,g;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("进入initializtion()方法"),!this.selectdata.actorexpression){t.next=13;break}return e=new _.HttpResetClass,a=this.$androidUtil.getProxyUrl()+"/rs/search",console.log("即将请求后台获取下发人员，url=>"+a),t.next=7,e.load("POST",a,this.selectdata.actorexpression,{resolveMsg:null,rejectMsg:"获取当前部门人员失败"});case 7:s=t.sent,console.log("请求后台获取下发人员结果转换=>"+(0,r.default)(s)),o=(0,r.default)(s.data),n=[],o.startsWith("{")&&(n.push(s.data),s.data=n),this.department_search=s.data;case 13:for(console.log("即将合并data与selectdata,selectdata数据=>"+(0,r.default)(this.selectdata)),this.data=(0,i.default)({},this.data,this.selectdata),console.log("this.data的值=>"+(0,r.default)(this.data)),console.log("this.data.fields.length=>"+this.data.fields.length),d=0;d<this.data.fields.length;d++)this.selectdata[this.data.fields[d].field]&&(this.data.fields[d].value=this.selectdata[this.data.fields[d].field]),"select"==this.data.fields[d].type&&(console.log("进入下拉框参数获取方法,参数名称=>"+this.data.fields[d].label),console.log("$appdata中的缓存参数与单值=>"+(0,r.default)(this.$appdata)),u=this.$appdata.getParam(this.data.fields[d].label),console.log(u),this.data.fields[d].options=u);for(c=0;c<this.data.buttons.length;c++)if(this.data.buttons[c].button_fields)for(h=0;h<this.data.buttons[c].button_fields.length;h++)if(this.selectdata[this.data.buttons[c].button_fields[h].field]&&(this.data.buttons[c].button_fields[h].value=this.selectdata[this.data.buttons[c].button_fields[h].field]),"select"===this.data.buttons[c].button_fields[h].type&&this.$appdata.getParam(this.data.buttons[c].button_fields[h].label)&&(this.data.buttons[c].button_fields[h].options=this.$appdata.getParam(this.data.buttons[c].button_fields[h].label)),"下发"===this.data.buttons[c].button_name)if(1===this.data.buttons[c].button_fields.length){if(this.selectdata[this.data.buttons[c].button_fields[0].field])for(f=0;f<this.department_search.length;f++)Number(this.department_search[f].id)===Number(this.selectdata[this.data.buttons[c].button_fields[0].field])&&(this.data.buttons[c].button_fields[0].value=this.department_search[f].name);if(this.department_search){for(p=[],b=0;b<this.department_search.length;b++)p.push({label:this.department_search[b].name,value:this.department_search[b].name});this.data.buttons[c].button_fields[0].options=p}}else this.$showMessage("下发按钮必须满足 当且仅当一个字段");g=JSON.parse((0,r.default)(this.data)),this.selectdata.f_back_reason&&(g.back_reason=this.selectdata.f_back_reason),console.log("即将给show_data赋值temp=>"+(0,r.default)(g)),this.show_data=g,console.log("initializtion()方法结束,showview"),this.showview=!0;case 25:case"end":return t.stop()}},t,this)}));return t}(),deleteLocalApply:function(t){console.log("前台上传完成，开始删除本地报建工单"),this.$androidUtil.bzLogic("deleteApply",{data:t})}},events:{select_cascade:function(t){},button:function(){function t(t){return e.apply(this,arguments)}var e=(0,c.default)(l.default.mark(function t(e){var a,s,o,n,d,u;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("进入async button事件方法"),a=!0,"保存"!=e.button.button_name&&"重置"!==e.button.button_name||(a=!1),"重置"!==e.button.button_name){t.next=6;break}return this.initializtion(),t.abrupt("return");case 6:if("下发"===e.button.button_name)for(s=e.button.button_fields[this.show_data.buttons[e.button.button_index].button_fields[0].field],o=0;o<this.department_search.length;o++)this.department_search[o].name===s&&(e.button.button_fields[this.show_data.buttons[e.button.button_index].button_fields[0].field]=this.department_search[o].id);console.log("button事件接收参数model=>"+(0,r.default)(e)),e=(0,i.default)({},this.selectdata,e),console.log("合并selectdata与model后的model=>"+(0,r.default)(e)),n=new _.HttpResetClass,d=this.$androidUtil.getProxyUrl()+"/rs/logic/ApplyProductService",u=g(this,d,n,e,a),(0,f.default)(u);case 14:case"end":return t.stop()}},t,this)}));return t}()},watch:{selectdata:function(){console.log("进入selectdata改变事件data=>"+(0,r.default)(this.selectdata)),this.refurbish()},deep:!0}};var g=l.default.mark(function t(e,a,s,o,i){return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:console.log("即将请求后台url=>"+a),s.load("POST",a,{data:{tables:e.data.tables,start_activity:e.$workflow_vue.start_activity,model:o,loginUser:b.default.user}},{resolveMsg:null,rejectMsg:null}).then(function(t){console.log((0,r.default)(t)),(t.code=200)?(e.showview=!1,i&&e.deleteLocalApply(o),e.special(o),e.$dispatch("close"),e.initializtion(),e.$showMessage("操作成功")):e.$showMessage("操作失败,原因:"+t.data.msg)}).catch(function(t){e.$showMessage("操作异常,原因:"+(0,r.default)(t.data))});case 2:case"end":return t.stop()}},t,this)})},127:function(t,e){t.exports=" <service-view-app v-ref:service_show :data=show_data v-if=showview></service-view-app> "},134:function(t,e,a){var s,o,i={};s=a(79),o=a(127),t.exports=s||{},t.exports.__esModule&&(t.exports=t.exports.default);var n="function"==typeof t.exports?t.exports.options||(t.exports.options={}):t.exports;o&&(n.template=o),n.computed||(n.computed={}),Object.keys(i).forEach(function(t){var e=i[t];n.computed[t]=function(){return e}})}});
//# sourceMappingURL=72.js.map