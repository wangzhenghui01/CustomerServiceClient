{"version":3,"sources":["webpack:///77.js","webpack:///ProjectSettlement.vue","webpack:///./src/components/product/Process/Processes/ProjectSettlement.vue?a4e7","webpack:///./src/components/product/Process/Processes/ProjectSettlement.vue"],"names":["webpackJsonp","410","module","exports","__webpack_require__","_interopRequireDefault","obj","__esModule","default","Object","defineProperty","value","_regenerator","_regenerator2","_asyncToGenerator2","_asyncToGenerator3","_vueClient","insert","_ref","mark","_callee","self","param","wrap","_context","prev","next","f_cost_name","model","f_cost_money","f_processid","selectdata","f_process_id","f_remarks","f_state","f_material_operator","$login","f","name","console","log","$resetpost","then","search","modifyshow","stop","this","_x","apply","arguments","deletecost","_ref2","_callee2","_context2","id","updaterow","_x2","update","_ref3","_callee3","_context3","updateshow","_x3","title","props","data","PagedList","orderitem","othermodel","number","cost","all","ready","methods","condition","othercondition","getnumber","getcost","_this","resolveMsg","rejectMsg","res","f_cost","_this2","f_price","modify","modifyclose","modifyConfirm","_ref4","_callee4","_this3","_context4","$showAlert","abrupt","$showMessage","row","updateclose","updateConfirm","_ref5","_callee5","_this4","_context5","delete","_this5","computed","events","watch","$dispatch","832","1041","__vue_script__","__vue_template__","__vue_styles__","__vue_options__","options","template","keys","forEach","key"],"mappings":"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","file":"77.js","sourcesContent":["webpackJsonp([77],{\n\n/***/ 410:\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _regenerator = __webpack_require__(2);\n\t\n\tvar _regenerator2 = _interopRequireDefault(_regenerator);\n\t\n\tvar _asyncToGenerator2 = __webpack_require__(4);\n\t\n\tvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\t\n\tvar _vueClient = __webpack_require__(3);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tvar insert = function () {\n\t  var _ref = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee(self) {\n\t    var param;\n\t    return _regenerator2.default.wrap(function _callee$(_context) {\n\t      while (1) {\n\t        switch (_context.prev = _context.next) {\n\t          case 0:\n\t            param = {\n\t              f_cost_name: self.model.f_cost_name,\n\t              f_cost_money: self.model.f_cost_money,\n\t              f_processid: self.selectdata.f_process_id,\n\t              f_remarks: self.model.f_remarks,\n\t              f_state: '1',\n\t              f_material_operator: self.$login.f.name\n\t            };\n\t\n\t            console.log('新增成本项', param);\n\t            self.$resetpost('rs/logic/insertcost', param).then(function () {\n\t              console.log('更新成功！');\n\t              self.search();\n\t            });\n\t            self.search();\n\t            self.modifyshow = false;\n\t\n\t          case 5:\n\t          case 'end':\n\t            return _context.stop();\n\t        }\n\t      }\n\t    }, _callee, this);\n\t  }));\n\t\n\t  return function insert(_x) {\n\t    return _ref.apply(this, arguments);\n\t  };\n\t}();\n\tvar deletecost = function () {\n\t  var _ref2 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee2(self) {\n\t    var param;\n\t    return _regenerator2.default.wrap(function _callee2$(_context2) {\n\t      while (1) {\n\t        switch (_context2.prev = _context2.next) {\n\t          case 0:\n\t            param = {\n\t              id: self.updaterow.id,\n\t              f_state: '0'\n\t            };\n\t\n\t            console.log('移除成本项', param);\n\t            self.$resetpost('rs/logic/insertcost', param).then(function () {\n\t              console.log('更新成功！');\n\t              self.search();\n\t            });\n\t            self.search();\n\t            self.modifyshow = false;\n\t\n\t          case 5:\n\t          case 'end':\n\t            return _context2.stop();\n\t        }\n\t      }\n\t    }, _callee2, this);\n\t  }));\n\t\n\t  return function deletecost(_x2) {\n\t    return _ref2.apply(this, arguments);\n\t  };\n\t}();\n\tvar update = function () {\n\t  var _ref3 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee3(self) {\n\t    var param;\n\t    return _regenerator2.default.wrap(function _callee3$(_context3) {\n\t      while (1) {\n\t        switch (_context3.prev = _context3.next) {\n\t          case 0:\n\t            param = {\n\t              id: self.updaterow.id,\n\t              f_cost_name: self.updaterow.f_cost_name,\n\t              f_remarks: self.updaterow.f_remarks,\n\t              f_cost_money: self.updaterow.f_cost_money\n\t            };\n\t\n\t            console.log('修改成本项', param);\n\t            self.$resetpost('rs/logic/insertcost', param).then(function () {\n\t              console.log('更新成功！');\n\t              self.search();\n\t            });\n\t            self.search();\n\t            self.updateshow = false;\n\t\n\t          case 5:\n\t          case 'end':\n\t            return _context3.stop();\n\t        }\n\t      }\n\t    }, _callee3, this);\n\t  }));\n\t\n\t  return function update(_x3) {\n\t    return _ref3.apply(this, arguments);\n\t  };\n\t}();\n\texports.default = {\n\t  title: '工程结算',\n\t  props: ['selectdata', 'edit'],\n\t  data: function data() {\n\t    return {\n\t      model: new _vueClient.PagedList('rs/sql/getMaterialFinal', 8, { orderitem: '`id`' }),\n\t      othermodel: new _vueClient.PagedList('rs/sql/getCost', 8, { orderitem: '`id`' }),\n\t      number: 0,\n\t      cost: 0,\n\t      all: 0,\n\t      modifyshow: false,\n\t      updateshow: false,\n\t      updaterow: null\n\t    };\n\t  },\n\t  ready: function ready() {\n\t    this.search();\n\t  },\n\t\n\t  methods: {\n\t    search: function search() {\n\t      console.log('执行查询');\n\t      var condition = ' processid  = \\'' + this.selectdata.f_process_id + '\\'';\n\t      var othercondition = ' f_processid  = \\'' + this.selectdata.f_process_id + '\\'';\n\t      this.model.search(condition);\n\t      this.othermodel.search(othercondition);\n\t      this.getnumber(condition);\n\t    },\n\t    getcost: function getcost() {\n\t      var _this = this;\n\t\n\t      var othercondition = ' f_processid  = \\'' + this.selectdata.f_process_id + '\\'';\n\t      this.$resetpost('rs/sql/getCostAll', { data: { condition: othercondition, orderitem: 'f_cost desc' } }, { resolveMsg: null, rejectMsg: null }).then(function (res) {\n\t        console.log('res2', res.data[0].f_cost);\n\t        if (res.data[0].f_cost) {\n\t          _this.cost = res.data[0].f_cost;\n\t        }\n\t        console.log('2222222222222222');\n\t      });\n\t    },\n\t    getnumber: function getnumber(condition) {\n\t      var _this2 = this;\n\t\n\t      this.$resetpost('rs/sql/getMaterialPrice', { data: { condition: condition, orderitem: 'f_price desc' } }, { resolveMsg: null, rejectMsg: null }).then(function (res) {\n\t        console.log('res', res.data[0].f_price);\n\t        if (res.data[0].f_price) {\n\t          _this2.number = res.data[0].f_price;\n\t        }\n\t        _this2.getcost();\n\t        console.log('11111111111');\n\t      });\n\t    },\n\t    modify: function modify() {\n\t      this.modifyshow = true;\n\t    },\n\t    modifyclose: function modifyclose() {\n\t      this.modifyshow = false;\n\t    },\n\t    modifyConfirm: function () {\n\t      var _ref4 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee4() {\n\t        var _this3 = this;\n\t\n\t        return _regenerator2.default.wrap(function _callee4$(_context4) {\n\t          while (1) {\n\t            switch (_context4.prev = _context4.next) {\n\t              case 0:\n\t                if (this.model.f_cost_name) {\n\t                  _context4.next = 3;\n\t                  break;\n\t                }\n\t\n\t                this.$showAlert(\"请输入成本项\", \"warning\", 1500);\n\t                return _context4.abrupt('return');\n\t\n\t              case 3:\n\t                if (this.model.f_cost_money) {\n\t                  _context4.next = 6;\n\t                  break;\n\t                }\n\t\n\t                this.$showAlert(\"请输入成本金额\", \"warning\", 1500);\n\t                return _context4.abrupt('return');\n\t\n\t              case 6:\n\t                _context4.next = 8;\n\t                return this.$showMessage('\\u662F\\u5426\\u786E\\u8BA4\\u6DFB\\u52A0\\u65B0\\u7684\\u6210\\u672C\\u9879', ['confirm', 'cancel']).then(function (res) {\n\t                  if (res === 'confirm') {\n\t                    insert(_this3);\n\t                  }\n\t                });\n\t\n\t              case 8:\n\t              case 'end':\n\t                return _context4.stop();\n\t            }\n\t          }\n\t        }, _callee4, this);\n\t      }));\n\t\n\t      function modifyConfirm() {\n\t        return _ref4.apply(this, arguments);\n\t      }\n\t\n\t      return modifyConfirm;\n\t    }(),\n\t    update: function update(row) {\n\t      this.updaterow = row;\n\t      this.updateshow = true;\n\t    },\n\t    updateclose: function updateclose() {\n\t      this.search();\n\t      this.updateshow = false;\n\t    },\n\t    updateConfirm: function () {\n\t      var _ref5 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee5() {\n\t        var _this4 = this;\n\t\n\t        return _regenerator2.default.wrap(function _callee5$(_context5) {\n\t          while (1) {\n\t            switch (_context5.prev = _context5.next) {\n\t              case 0:\n\t                if (this.updaterow.f_cost_name) {\n\t                  _context5.next = 3;\n\t                  break;\n\t                }\n\t\n\t                this.$showAlert(\"请输入成本项\", \"warning\", 1500);\n\t                return _context5.abrupt('return');\n\t\n\t              case 3:\n\t                if (this.updaterow.f_cost_money) {\n\t                  _context5.next = 6;\n\t                  break;\n\t                }\n\t\n\t                this.$showAlert(\"请输入成本金额\", \"warning\", 1500);\n\t                return _context5.abrupt('return');\n\t\n\t              case 6:\n\t                _context5.next = 8;\n\t                return this.$showMessage('\\u662F\\u5426\\u786E\\u8BA4\\u4FEE\\u6539\\u6B64\\u6210\\u672C\\u9879', ['confirm', 'cancel']).then(function (res) {\n\t                  if (res === 'confirm') {\n\t                    update(_this4);\n\t                  }\n\t                });\n\t\n\t              case 8:\n\t              case 'end':\n\t                return _context5.stop();\n\t            }\n\t          }\n\t        }, _callee5, this);\n\t      }));\n\t\n\t      function updateConfirm() {\n\t        return _ref5.apply(this, arguments);\n\t      }\n\t\n\t      return updateConfirm;\n\t    }(),\n\t    delete: function _delete(row) {\n\t      var _this5 = this;\n\t\n\t      this.updaterow = row;\n\t      this.$showMessage('\\u662F\\u5426\\u786E\\u8BA4\\u5220\\u9664\\u6B64\\u6210\\u672C\\u9879', ['confirm', 'cancel']).then(function (res) {\n\t        if (res === 'confirm') {\n\t          deletecost(_this5);\n\t        }\n\t      });\n\t    }\n\t  },\n\t  computed: {},\n\t  events: {},\n\t  watch: {\n\t    'number': function number() {\n\t      this.all = this.cost + this.number;\n\t      this.$dispatch('get-price', this.all, '点火');\n\t    },\n\t    'cost': function cost() {\n\t      this.all = this.cost + this.number;\n\t      this.$dispatch('get-price', this.all, '点火');\n\t    }\n\t  }\n\t};\n\n/***/ }),\n\n/***/ 832:\n/***/ (function(module, exports) {\n\n\tmodule.exports = \" <div class=flex style=\\\"height: auto\\\"> <div style=\\\"height: auto\\\" class=flex> <p class=\\\"bg-info text-center\\\" style=\\\"padding: 8px;font-size: 20px\\\">最终材料表 </p> <div class=\\\"form-inline auto\\\" style=\\\"margin-bottom: 5px\\\"> <criteria-paged :model=model :pager=true v-ref:paged> <data-grid :model=model v-ref:grid partial=list> <template partial=head> <tr> <th><nobr>序号</nobr></th> <th><nobr>材料名称</nobr></th> <th><nobr>数量</nobr></th> <th><nobr>单位</nobr></th> <th><nobr>单价</nobr></th> <th><nobr>合计金额</nobr></th> </tr> </template> <template partial=body> <td style=\\\"text-align: center\\\">{{$index + 1}}</td> <td style=\\\"text-align: center\\\">{{row.f_batch_name}}</td> <td style=\\\"text-align: center\\\">{{row.f_add_receive}}</td> <td style=\\\"text-align: center\\\">{{row.f_batch_company}}</td> <td style=\\\"text-align: center\\\">{{row.f_batch_price}}</td> <td style=\\\"text-align: center\\\">{{row.totalprice}}</td> </template> </data-grid> </criteria-paged> </div> </div> <div style=\\\"height: auto\\\" class=flex> <div class=\\\"bg-info text-center\\\" style=\\\"padding: 8px;font-size: 20px\\\">其他成本 </div> <div class=\\\"form-inline auto bg-info\\\" style=\\\"float: right\\\"> <div class=form-group style=\\\"float: right\\\"> <button class=\\\"btn btn-success\\\" @click=modify()>新增</button> </div> </div> <div class=\\\"form-inline auto\\\" style=\\\"margin-bottom: 5px\\\"> <criteria-paged :model=othermodel :pager=true v-ref:paged1> <data-grid :model=$parent.othermodel v-ref:grid1 partial=list> <template partial=head> <tr> <th><nobr>序号</nobr></th> <th><nobr>成本项</nobr></th> <th><nobr>成本金额</nobr></th> <th><nobr>备注</nobr></th> <th><nobr>操作人</nobr></th> <th><nobr>操作</nobr></th> </tr> </template> <template partial=body> <td style=\\\"text-align: center\\\">{{$index + 1}}</td> <td style=\\\"text-align: center\\\">{{row.f_cost_name}}</td> <td style=\\\"text-align: center\\\">{{row.f_cost_money}}</td> <td style=\\\"text-align: center\\\">{{row.f_remarks}}</td> <td style=\\\"text-align: center\\\">{{row.f_material_operator}}</td> <td style=\\\"text-align: center\\\"> <button type=button name=button class=\\\"btn btn-link\\\" @click=$parent.$parent.$parent.update(row)>修正 </button> <button type=button name=button class=\\\"btn btn-link\\\" @click=$parent.$parent.$parent.delete(row)>移除 </button> </td> </template> </data-grid> </criteria-paged> </div> </div> <modal :show.sync=modifyshow backdrop=false> <header slot=modal-header class=modal-header> <h4 class=modal-title>新增成本项</h4> </header> <article slot=modal-body class=modal-body> <form class=form-horizontal> <div class=form-group> <label for=f_cost_name class=control-label>成本项</label> <input type=text class=\\\"form-control col-sm-2\\\" v-model=model.f_cost_name placeholder=成本项> </div> <div class=form-group> <label for=f_cost_money class=control-label>成本金额</label> <input type=text class=form-control v-model=model.f_cost_money placeholder=成本金额> </div> <div class=form-group> <label for=f_remarks class=control-label>备注</label> <input type=text class=form-control v-model=model.f_remarks placeholder=备注> </div> </form> </article> <footer slot=modal-footer class=modal-footer> <button type=button class=\\\"btn btn-success\\\" @click=modifyConfirm>确认</button> <button type=button class=\\\"btn btn-default\\\" @click=modifyclose>取消</button> </footer> </modal> <modal :show.sync=updateshow backdrop=false> <header slot=modal-header class=modal-header> <h4 class=modal-title>新增成本项</h4> </header> <article slot=modal-body class=modal-body> <form class=form-horizontal> <div class=form-group> <label for=f_cost_name class=control-label>成本项</label> <input type=text class=\\\"form-control col-sm-2\\\" v-model=updaterow.f_cost_name placeholder=成本项> </div> <div class=form-group> <label for=f_cost_money class=control-label>成本金额</label> <input type=text class=form-control v-model=updaterow.f_cost_money placeholder=成本金额> </div> <div class=form-group> <label for=f_remarks class=control-label>备注</label> <input type=text class=form-control v-model=updaterow.f_remarks placeholder=备注> </div> </form> </article> <footer slot=modal-footer class=modal-footer> <button type=button class=\\\"btn btn-success\\\" @click=updateConfirm>确认</button> <button type=button class=\\\"btn btn-default\\\" @click=updateclose>取消</button> </footer> </modal> </div> \";\n\n/***/ }),\n\n/***/ 1041:\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar __vue_script__, __vue_template__\n\tvar __vue_styles__ = {}\n\t__vue_script__ = __webpack_require__(410)\n\t__vue_template__ = __webpack_require__(832)\n\tmodule.exports = __vue_script__ || {}\n\tif (module.exports.__esModule) module.exports = module.exports.default\n\tvar __vue_options__ = typeof module.exports === \"function\" ? (module.exports.options || (module.exports.options = {})) : module.exports\n\tif (__vue_template__) {\n\t__vue_options__.template = __vue_template__\n\t}\n\tif (!__vue_options__.computed) __vue_options__.computed = {}\n\tObject.keys(__vue_styles__).forEach(function (key) {\n\tvar module = __vue_styles__[key]\n\t__vue_options__.computed[key] = function () { return module }\n\t})\n\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// 77.js","<template>\r\n  <div class=\"flex\" style=\"height: auto\">\r\n    <div style=\"height: auto\" class=\"flex\">\r\n      <p class=\"bg-info text-center\" style=\"padding: 8px;font-size: 20px\">最终材料表\r\n      </p>\r\n      <div class=\"form-inline auto\"  style=\"margin-bottom: 5px;\">\r\n        <criteria-paged :model=\"model\" :pager=\"true\" v-ref:paged >\r\n          <data-grid :model=\"model\" v-ref:grid  partial='list'>\r\n            <template partial='head'>\r\n              <tr>\r\n                <th><nobr>序号</nobr></th>\r\n                <th><nobr>材料名称</nobr></th>\r\n                <th><nobr>数量</nobr></th>\r\n                <th><nobr>单位</nobr></th>\r\n                <th><nobr>单价</nobr></th>\r\n                <th><nobr>合计金额</nobr></th>\r\n              </tr>\r\n            </template>\r\n            <template partial='body'>\r\n              <td style=\"text-align: center;\">{{$index + 1}}</td>\r\n              <td style=\"text-align: center;\">{{row.f_batch_name}}</td>\r\n              <td style=\"text-align: center;\">{{row.f_add_receive}}</td>\r\n              <td style=\"text-align: center;\">{{row.f_batch_company}}</td>\r\n              <td style=\"text-align: center;\">{{row.f_batch_price}}</td>\r\n              <td style=\"text-align: center;\">{{row.totalprice}}</td>\r\n            </template>\r\n          </data-grid>\r\n        </criteria-paged>\r\n      </div>\r\n    </div>\r\n\r\n    <div style=\"height: auto\" class=\"flex\">\r\n      <div class=\"bg-info text-center\" style=\"padding: 8px;font-size: 20px\">其他成本\r\n      </div>\r\n      <div  class=\"form-inline auto bg-info\"  style=\"float: right\" >\r\n        <div class=\"form-group\"  style=\"float: right\">\r\n          <button class=\"btn btn-success\" @click=\"modify()\">新增</button>\r\n        </div>\r\n      </div>\r\n      <div class=\"form-inline auto\"  style=\"margin-bottom: 5px;\">\r\n        <criteria-paged :model=\"othermodel\" :pager=\"true\" v-ref:paged1 >\r\n          <data-grid :model=\"$parent.othermodel\" v-ref:grid1  partial='list'>\r\n            <template partial='head'>\r\n              <tr>\r\n                <th><nobr>序号</nobr></th>\r\n                <th><nobr>成本项</nobr></th>\r\n                <th><nobr>成本金额</nobr></th>\r\n                <th><nobr>备注</nobr></th>\r\n                <th><nobr>操作人</nobr></th>\r\n                <th><nobr>操作</nobr></th>\r\n              </tr>\r\n            </template>\r\n            <template partial='body'>\r\n              <td style=\"text-align: center;\">{{$index + 1}}</td>\r\n              <td style=\"text-align: center;\">{{row.f_cost_name}}</td>\r\n              <td style=\"text-align: center;\">{{row.f_cost_money}}</td>\r\n              <td style=\"text-align: center;\">{{row.f_remarks}}</td>\r\n              <td style=\"text-align: center;\">{{row.f_material_operator}}</td>\r\n              <td style=\"text-align: center;\">\r\n                <button type=\"button\" name=\"button\" class=\"btn btn-link\"\r\n                        @click=\"$parent.$parent.$parent.update(row)\">修正\r\n                </button>\r\n                <button type=\"button\" name=\"button\" class=\"btn btn-link\"\r\n                        @click=\"$parent.$parent.$parent.delete(row)\">移除\r\n                </button>\r\n              </td>\r\n            </template>\r\n          </data-grid>\r\n        </criteria-paged>\r\n      </div>\r\n    </div>\r\n    <modal :show.sync=\"modifyshow\" backdrop=\"false\">\r\n      <header slot=\"modal-header\" class=\"modal-header\">\r\n        <h4 class=\"modal-title\">新增成本项</h4>\r\n      </header>\r\n      <article slot=\"modal-body\" class=\"modal-body\">\r\n        <form class=\"form-horizontal\">\r\n          <div class=\"form-group\" >\r\n            <label for=\"f_cost_name\" class=\"control-label\">成本项</label>\r\n            <input type=\"text\" class=\"form-control col-sm-2\" v-model=\"model.f_cost_name\"\r\n                   placeholder='成本项'>\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label for=\"f_cost_money\" class=\"control-label\">成本金额</label>\r\n            <input type=\"text\" class=\"form-control\" v-model=\"model.f_cost_money\"\r\n                   placeholder='成本金额'>\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label for=\"f_remarks\" class=\"control-label\">备注</label>\r\n            <input type=\"text\" class=\"form-control\" v-model=\"model.f_remarks\"\r\n                   placeholder='备注'>\r\n          </div>\r\n        </form>\r\n      </article>\r\n      <footer slot=\"modal-footer\" class=\"modal-footer\">\r\n        <button type=\"button\" class=\"btn btn-success\" @click='modifyConfirm'>确认</button>\r\n        <button type=\"button\" class=\"btn btn-default\" @click='modifyclose'>取消</button>\r\n      </footer>\r\n    </modal>\r\n    <modal :show.sync=\"updateshow\" backdrop=\"false\">\r\n      <header slot=\"modal-header\" class=\"modal-header\">\r\n        <h4 class=\"modal-title\">新增成本项</h4>\r\n      </header>\r\n      <article slot=\"modal-body\" class=\"modal-body\">\r\n        <form class=\"form-horizontal\">\r\n          <div class=\"form-group\" >\r\n            <label for=\"f_cost_name\" class=\"control-label\">成本项</label>\r\n            <input type=\"text\" class=\"form-control col-sm-2\" v-model=\"updaterow.f_cost_name\"\r\n                   placeholder='成本项'>\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label for=\"f_cost_money\" class=\"control-label\">成本金额</label>\r\n            <input type=\"text\" class=\"form-control\" v-model=\"updaterow.f_cost_money\"\r\n                   placeholder='成本金额'>\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label for=\"f_remarks\" class=\"control-label\">备注</label>\r\n            <input type=\"text\" class=\"form-control\" v-model=\"updaterow.f_remarks\"\r\n                   placeholder='备注'>\r\n          </div>\r\n        </form>\r\n      </article>\r\n      <footer slot=\"modal-footer\" class=\"modal-footer\">\r\n        <button type=\"button\" class=\"btn btn-success\" @click='updateConfirm'>确认</button>\r\n        <button type=\"button\" class=\"btn btn-default\" @click='updateclose'>取消</button>\r\n      </footer>\r\n    </modal>\r\n  </div>\r\n</template>\r\n<script>\r\n  import { PagedList } from 'vue-client'\r\n  let insert = async function (self) {\r\n    let param = {\r\n      f_cost_name: self.model.f_cost_name,\r\n      f_cost_money: self.model.f_cost_money,\r\n      f_processid: self.selectdata.f_process_id,\r\n      f_remarks:self.model.f_remarks,\r\n      f_state: '1',\r\n      f_material_operator: self.$login.f.name\r\n    }\r\n    console.log('新增成本项', param)\r\n    self.$resetpost('rs/logic/insertcost', param).then(() => {\r\n      // this.params.rows.splice(index, 1)\r\n      console.log('更新成功！')\r\n      self.search()\r\n    })\r\n    self.search()\r\n    self.modifyshow = false\r\n  }\r\n  let deletecost = async function (self) {\r\n    let param = {\r\n      id: self.updaterow.id,\r\n      f_state: '0'\r\n    }\r\n    console.log('移除成本项', param)\r\n    self.$resetpost('rs/logic/insertcost', param).then(() => {\r\n      // this.params.rows.splice(index, 1)\r\n      console.log('更新成功！')\r\n      self.search()\r\n    })\r\n    self.search()\r\n    self.modifyshow = false\r\n  }\r\n  let update = async function (self) {\r\n    let param = {\r\n      id: self.updaterow.id,\r\n      f_cost_name: self.updaterow.f_cost_name,\r\n      f_remarks:self.updaterow.f_remarks,\r\n      f_cost_money: self.updaterow.f_cost_money\r\n    }\r\n    console.log('修改成本项', param)\r\n    self.$resetpost('rs/logic/insertcost', param).then(() => {\r\n      // this.params.rows.splice(index, 1)\r\n      console.log('更新成功！')\r\n      self.search()\r\n    })\r\n    self.search()\r\n    self.updateshow = false\r\n  }\r\n  export default {\r\n    title: '工程结算',\r\n    props: ['selectdata','edit'],\r\n    data () {\r\n      return {\r\n        model: new PagedList('rs/sql/getMaterialFinal', 8, { orderitem: '`id`'}),\r\n        othermodel: new PagedList('rs/sql/getCost', 8, { orderitem: '`id`'}),\r\n        number:0,\r\n        cost:0,\r\n        all:0,\r\n        modifyshow:false,\r\n        updateshow:false,\r\n        updaterow:null\r\n      }\r\n    },\r\n    ready () {\r\n      this.search()\r\n    },\r\n    methods: {\r\n      search () {\r\n        console.log('执行查询')\r\n        let condition = ` processid  = '${this.selectdata.f_process_id}'`\r\n        let othercondition = ` f_processid  = '${this.selectdata.f_process_id}'`\r\n        this.model.search(condition)\r\n        this.othermodel.search(othercondition)\r\n        this.getnumber(condition)\r\n      },\r\n      getcost(){\r\n        let othercondition = ` f_processid  = '${this.selectdata.f_process_id}'`\r\n        this.$resetpost('rs/sql/getCostAll', {data:{condition: othercondition,orderitem: `f_cost desc`}}, {resolveMsg: null, rejectMsg: null}).then((res) => {\r\n          console.log('res2',res.data[0].f_cost)\r\n          if (res.data[0].f_cost){\r\n            this.cost =res.data[0].f_cost\r\n          }\r\n          console.log('2222222222222222')\r\n        })\r\n      },\r\n      getnumber(condition){\r\n        this.$resetpost('rs/sql/getMaterialPrice', {data:{condition: condition,orderitem: `f_price desc`}}, {resolveMsg: null, rejectMsg: null}).then((res) => {\r\n          console.log('res',res.data[0].f_price)\r\n          if (res.data[0].f_price){\r\n            this.number =res.data[0].f_price\r\n          }\r\n          this.getcost()\r\n          console.log('11111111111')\r\n        })\r\n      },\r\n      modify(){\r\n        this.modifyshow = true\r\n      },\r\n      modifyclose(){\r\n        this.modifyshow = false\r\n      },\r\n      async modifyConfirm(){\r\n        if(!this.model.f_cost_name){\r\n          this.$showAlert(\"请输入成本项\",\"warning\", 1500)\r\n          return\r\n        }\r\n        if(!this.model.f_cost_money){\r\n          this.$showAlert(\"请输入成本金额\",\"warning\", 1500)\r\n          return\r\n        }\r\n        await this.$showMessage(`是否确认添加新的成本项`, ['confirm', 'cancel']).then((res) => {\r\n          if (res === 'confirm') {\r\n            insert(this)\r\n          }\r\n        })\r\n      },\r\n      update(row){\r\n        this.updaterow = row\r\n        this.updateshow = true\r\n      },\r\n      updateclose(){\r\n        this.search()\r\n        this.updateshow = false\r\n      },\r\n      async updateConfirm(){\r\n        if(!this.updaterow.f_cost_name){\r\n          this.$showAlert(\"请输入成本项\",\"warning\", 1500)\r\n          return\r\n        }\r\n        if(!this.updaterow.f_cost_money){\r\n          this.$showAlert(\"请输入成本金额\",\"warning\", 1500)\r\n          return\r\n        }\r\n        await this.$showMessage(`是否确认修改此成本项`, ['confirm', 'cancel']).then((res) => {\r\n          if (res === 'confirm') {\r\n            update(this)\r\n          }\r\n        })\r\n      },\r\n      delete(row){\r\n        this.updaterow = row\r\n        this.$showMessage(`是否确认删除此成本项`, ['confirm', 'cancel']).then((res) => {\r\n          if (res === 'confirm') {\r\n            deletecost (this)\r\n          }\r\n        })\r\n      }\r\n\r\n    },\r\n    computed: {\r\n\r\n    },\r\n    events: {\r\n\r\n    },\r\n    watch: {\r\n      'number' (){\r\n        this.all = this.cost+this.number\r\n        this.$dispatch('get-price', this.all,'点火')\r\n      },\r\n      'cost' (){\r\n        this.all = this.cost+this.number\r\n        this.$dispatch('get-price', this.all,'点火')\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\n\n\n// WEBPACK FOOTER //\n// ProjectSettlement.vue?5377bcb2","module.exports = \" <div class=flex style=\\\"height: auto\\\"> <div style=\\\"height: auto\\\" class=flex> <p class=\\\"bg-info text-center\\\" style=\\\"padding: 8px;font-size: 20px\\\">最终材料表 </p> <div class=\\\"form-inline auto\\\" style=\\\"margin-bottom: 5px\\\"> <criteria-paged :model=model :pager=true v-ref:paged> <data-grid :model=model v-ref:grid partial=list> <template partial=head> <tr> <th><nobr>序号</nobr></th> <th><nobr>材料名称</nobr></th> <th><nobr>数量</nobr></th> <th><nobr>单位</nobr></th> <th><nobr>单价</nobr></th> <th><nobr>合计金额</nobr></th> </tr> </template> <template partial=body> <td style=\\\"text-align: center\\\">{{$index + 1}}</td> <td style=\\\"text-align: center\\\">{{row.f_batch_name}}</td> <td style=\\\"text-align: center\\\">{{row.f_add_receive}}</td> <td style=\\\"text-align: center\\\">{{row.f_batch_company}}</td> <td style=\\\"text-align: center\\\">{{row.f_batch_price}}</td> <td style=\\\"text-align: center\\\">{{row.totalprice}}</td> </template> </data-grid> </criteria-paged> </div> </div> <div style=\\\"height: auto\\\" class=flex> <div class=\\\"bg-info text-center\\\" style=\\\"padding: 8px;font-size: 20px\\\">其他成本 </div> <div class=\\\"form-inline auto bg-info\\\" style=\\\"float: right\\\"> <div class=form-group style=\\\"float: right\\\"> <button class=\\\"btn btn-success\\\" @click=modify()>新增</button> </div> </div> <div class=\\\"form-inline auto\\\" style=\\\"margin-bottom: 5px\\\"> <criteria-paged :model=othermodel :pager=true v-ref:paged1> <data-grid :model=$parent.othermodel v-ref:grid1 partial=list> <template partial=head> <tr> <th><nobr>序号</nobr></th> <th><nobr>成本项</nobr></th> <th><nobr>成本金额</nobr></th> <th><nobr>备注</nobr></th> <th><nobr>操作人</nobr></th> <th><nobr>操作</nobr></th> </tr> </template> <template partial=body> <td style=\\\"text-align: center\\\">{{$index + 1}}</td> <td style=\\\"text-align: center\\\">{{row.f_cost_name}}</td> <td style=\\\"text-align: center\\\">{{row.f_cost_money}}</td> <td style=\\\"text-align: center\\\">{{row.f_remarks}}</td> <td style=\\\"text-align: center\\\">{{row.f_material_operator}}</td> <td style=\\\"text-align: center\\\"> <button type=button name=button class=\\\"btn btn-link\\\" @click=$parent.$parent.$parent.update(row)>修正 </button> <button type=button name=button class=\\\"btn btn-link\\\" @click=$parent.$parent.$parent.delete(row)>移除 </button> </td> </template> </data-grid> </criteria-paged> </div> </div> <modal :show.sync=modifyshow backdrop=false> <header slot=modal-header class=modal-header> <h4 class=modal-title>新增成本项</h4> </header> <article slot=modal-body class=modal-body> <form class=form-horizontal> <div class=form-group> <label for=f_cost_name class=control-label>成本项</label> <input type=text class=\\\"form-control col-sm-2\\\" v-model=model.f_cost_name placeholder=成本项> </div> <div class=form-group> <label for=f_cost_money class=control-label>成本金额</label> <input type=text class=form-control v-model=model.f_cost_money placeholder=成本金额> </div> <div class=form-group> <label for=f_remarks class=control-label>备注</label> <input type=text class=form-control v-model=model.f_remarks placeholder=备注> </div> </form> </article> <footer slot=modal-footer class=modal-footer> <button type=button class=\\\"btn btn-success\\\" @click=modifyConfirm>确认</button> <button type=button class=\\\"btn btn-default\\\" @click=modifyclose>取消</button> </footer> </modal> <modal :show.sync=updateshow backdrop=false> <header slot=modal-header class=modal-header> <h4 class=modal-title>新增成本项</h4> </header> <article slot=modal-body class=modal-body> <form class=form-horizontal> <div class=form-group> <label for=f_cost_name class=control-label>成本项</label> <input type=text class=\\\"form-control col-sm-2\\\" v-model=updaterow.f_cost_name placeholder=成本项> </div> <div class=form-group> <label for=f_cost_money class=control-label>成本金额</label> <input type=text class=form-control v-model=updaterow.f_cost_money placeholder=成本金额> </div> <div class=form-group> <label for=f_remarks class=control-label>备注</label> <input type=text class=form-control v-model=updaterow.f_remarks placeholder=备注> </div> </form> </article> <footer slot=modal-footer class=modal-footer> <button type=button class=\\\"btn btn-success\\\" @click=updateConfirm>确认</button> <button type=button class=\\\"btn btn-default\\\" @click=updateclose>取消</button> </footer> </modal> </div> \";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/vue-html-loader!./~/vue-loader/lib/selector.js?type=template&index=0!./src/components/product/Process/Processes/ProjectSettlement.vue\n// module id = 832\n// module chunks = 77","var __vue_script__, __vue_template__\nvar __vue_styles__ = {}\n__vue_script__ = require(\"!!babel-loader?presets[]=es2015&plugins[]=transform-runtime&comments=false!../../../../../node_modules/vue-loader/lib/selector.js?type=script&index=0!./ProjectSettlement.vue\")\n__vue_template__ = require(\"!!vue-html-loader!../../../../../node_modules/vue-loader/lib/selector.js?type=template&index=0!./ProjectSettlement.vue\")\nmodule.exports = __vue_script__ || {}\nif (module.exports.__esModule) module.exports = module.exports.default\nvar __vue_options__ = typeof module.exports === \"function\" ? (module.exports.options || (module.exports.options = {})) : module.exports\nif (__vue_template__) {\n__vue_options__.template = __vue_template__\n}\nif (!__vue_options__.computed) __vue_options__.computed = {}\nObject.keys(__vue_styles__).forEach(function (key) {\nvar module = __vue_styles__[key]\n__vue_options__.computed[key] = function () { return module }\n})\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/product/Process/Processes/ProjectSettlement.vue\n// module id = 1041\n// module chunks = 77"],"sourceRoot":""}