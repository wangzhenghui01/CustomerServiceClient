webpackJsonp([98],{353:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=a(13),o=n(r),l=a(5),s=n(l),i=a(2),d=n(i),c=a(4),f=n(c),u=a(3),p=function(){var t=(0,f.default)(d.default.mark(function t(e){var a,n,r;return d.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={f_filiale:e.selectdata.f_filiale,f_apply_num:e.selectdata.f_apply_num,f_process_id:e.selectdata.f_process_id,f_batch_name:e.addrow.f_batch_name[0],f_unit:e.addrow.f_unit,f_number:e.addrow.f_number,f_price:e.addrow.f_price,f_cash:e.addrow.f_number*e.addrow.f_price,f_type:e.type,f_state:"1"},console.log("新增成本项",a),n=new u.HttpResetClass,r=e.$androidUtil.getProxyUrl()+"/rs/entity/t_batch_item",t.next=6,n.load("POST",r,a).then(function(){console.log("更新成功！"),e.addrow.f_batch_name=[],e.addrow.f_unit="",e.addrow.f_number="",e.addrow.f_price="",e.search()});case 6:e.search(),e.modifyshow=!1;case 8:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),h=function(){var t=(0,f.default)(d.default.mark(function t(e){var a;return d.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a={id:e.updaterow.id,f_state:"0"},console.log("移除成本项",a),e.$resetpost(e.$androidUtil.getProxyUrl()+"/rs/entity/t_batch_item",a).then(function(){console.log("更新成功！"),e.search()}),e.search(),e.modifyshow=!1;case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),m=function(){var t=(0,f.default)(d.default.mark(function t(e){var a;return d.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a={id:e.updaterow.id,f_batch_name:e.updaterow.f_batch_name,f_unit:e.updaterow.f_unit,f_number:e.updaterow.f_number,f_price:e.updaterow.f_price,f_cash:e.updaterow.f_number*e.updaterow.f_price},console.log("修改成本项",a),e.$resetpost(e.$androidUtil.getProxyUrl()+"/rs/entity/t_batch_item",a).then(function(){console.log("更新成功！"),e.updaterow=null,e.search()}),e.search(),e.updateshow=!1;case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}();e.default={title:"预算项目",props:["selectdata","edit"],data:function(){return{batchmodel:new u.PagedList(this.$androidUtil.getProxyUrl()+"/rs/sql/getBatchItem",8,{orderitem:"`id`"}),model:new u.PagedList(this.$androidUtil.getProxyUrl()+"/rs/sql/getBatchItem",8,{orderitem:"`id`"}),number:0,yusuan:0,numbergongliao:0,modifyshow:!1,updateshow:!1,updaterow:null,addrow:null,material:[],type:null,show:!1,iscash:[{label:"是",value:"是"},{label:"否",value:"否"}]}},ready:function(){this.search()},methods:{importemplate:function(){function t(){return e.apply(this,arguments)}var e=(0,f.default)(d.default.mark(function t(){var e,a,n,r,o=this;return d.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=[],e=this.$appdata.getSingleValue("材料导入模板")?(0,s.default)(this.$appdata.getSingleValue("材料导入模板")):[["燃气表"],["表接头"],["DN15镀锌管"],["DN15弯头*90"],["DN15外丝直连"],["DN15三通"],["铜球阀"],["单嘴阀"]],a=0;case 3:if(!(a<e.length)){t.next=18;break}return this.addrow.f_batch_name=e[a],this.$set("updaterow.f_batch_name",e[a]),this.addrow.f_number=1,n=new u.HttpResetClass,t.next=10,n.load("POST",this.$androidUtil.getProxyUrl()+"/rs/logic/getMaterialItem",{data:{condition:"f_name = '"+this.addrow.f_batch_name[0]+"' and f_use_type='预算/结算项目'"}},{resolveMsg:null,rejectMsg:null}).then(function(t){console.log("查询到的选项",t),o.addrow.f_price=t.data.material[0].f_price,o.addrow.f_unit=t.data.material[0].f_unit});case 10:return r=new u.HttpResetClass,t.next=13,r.load("POST",this.$androidUtil.getProxyUrl()+"/rs/logic/getMaterialItem",{data:{condition:"f_name = '"+this.updaterow.f_batch_name[0]+"' and f_use_type='预算/结算项目'"}},{resolveMsg:null,rejectMsg:null}).then(function(t){console.log("查询到的选项",t),o.updaterow.f_price=t.data.material[0].f_price,o.updaterow.f_unit=t.data.material[0].f_unit});case 13:return t.next=15,this.modifyConfirm();case 15:a++,t.next=3;break;case 18:this.search();case 19:case"end":return t.stop()}},t,this)}));return t}(),importbudget:function(){function t(){return e.apply(this,arguments)}var e=(0,f.default)(d.default.mark(function t(){var e,a,n,r,o,l=this;return d.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=this.batchmodel.rows,a=0;case 2:if(!(a<e.length)){t.next=19;break}return n=[],n.push(e[a].f_batch_name),this.addrow.f_batch_name=n,this.$set("updaterow.f_batch_name",n),this.addrow.f_number=e[a].f_number,r=new u.HttpResetClass,t.next=11,r.load("POST",this.$androidUtil.getProxyUrl()+"/rs/logic/getMaterialItem",{data:{condition:"f_name = '"+this.addrow.f_batch_name[0]+"' and f_use_type='预算/结算项目'"}},{resolveMsg:null,rejectMsg:null}).then(function(t){console.log("查询到的选项",t),l.addrow.f_price=t.data.material[0].f_price,l.addrow.f_unit=t.data.material[0].f_unit});case 11:return o=new u.HttpResetClass,t.next=14,o.load("POST",this.$androidUtil.getProxyUrl()+"/rs/logic/getMaterialItem",{data:{condition:"f_name = '"+this.updaterow.f_batch_name[0]+"' and f_use_type='预算/结算项目'"}},{resolveMsg:null,rejectMsg:null}).then(function(t){console.log("查询到的选项",t),l.updaterow.f_price=t.data.material[0].f_price,l.updaterow.f_unit=t.data.material[0].f_unit});case 14:return t.next=16,this.modifyConfirm();case 16:a++,t.next=2;break;case 19:this.search();case 20:case"end":return t.stop()}},t,this)}));return t}(),getname:function(){var t=this;this.$resetpost(this.$androidUtil.getProxyUrl()+"/rs/logic/getMaterialItem",{data:{condition:"1=1 and f_use_type='预算/结算项目'"}},{resolveMsg:null,rejectMsg:null}).then(function(e){console.log("查询到的选项",e);var a=[],n=!0,r=!1,l=void 0;try{for(var s,i=(0,o.default)(e.data.material);!(n=(s=i.next()).done);n=!0){var d=s.value;a.push({label:d.f_name,value:d.f_name})}}catch(t){r=!0,l=t}finally{try{!n&&i.return&&i.return()}finally{if(r)throw l}}t.material=a})},search:function(){this.show=!1,console.log("执行查询"),"工商预算审核(技术科科长)"!=this.selectdata.defname&&"工商预算审核(分管副总)"!=this.selectdata.defname&&"工商预算审核(总经理)"!=this.selectdata.defname&&"工商现场勘查"!=this.selectdata.defname&&"民用现场勘查"!=this.selectdata.defname||(console.log("预算"),this.type="预算"),"户内安装"!=this.selectdata.defname&&"安装审核"!=this.selectdata.defname&&"点火申请"!=this.selectdata.defname&&"收费材料费"!=this.selectdata.defname&&"工程验收"!=this.selectdata.defname&&"点火"!=this.selectdata.defname||(console.log("结算"),this.type="结算"),"工商现场勘查"!=this.selectdata.defname&&"民用现场勘查"!=this.selectdata.defname&&"户内安装"!=this.selectdata.defname||(console.log("显示按钮"),this.show=!0);var t=" f_apply_num  = '"+this.selectdata.f_apply_num+"' and f_type='"+this.type+"'",e=" f_apply_num  = '"+this.selectdata.f_apply_num+"' and f_type='预算'";this.model.search(t),this.batchmodel.search(e),this.getnumber()},getnumber:function(){var t=this,e=new u.HttpResetClass,a=" f_apply_num  = '"+this.selectdata.f_apply_num+"' and f_batch_name like '%超%' and f_type='结算'";e.load("POST",this.$androidUtil.getProxyUrl()+"/rs/sql/getBatchPrice",{data:{condition:a,orderitem:"f_price desc"}},{resolveMsg:null,rejectMsg:null}).then(function(e){e.data[0].f_price?t.number=e.data[0].f_price:t.number=0,console.log("11111111111"),t.$dispatch("get-price",t.number,"结算")});var n=" f_apply_num  = '"+this.selectdata.f_apply_num+"' and f_batch_name like '%超%' and f_type='预算'",r=new u.HttpResetClass;r.load("POST",this.$androidUtil.getProxyUrl()+"/rs/sql/getBatchPrice",{data:{condition:n,orderitem:"f_price desc"}},{resolveMsg:null,rejectMsg:null}).then(function(e){e.data[0].f_price?t.yusuan=e.data[0].f_price:t.yusuan=0,console.log("11111111111"),t.$dispatch("get-price",t.yusuan,"预算")})},modify:function(){this.getname(),this.modifyshow=!0},modifyclose:function(){this.modifyshow=!1,this.addrow.f_batch_name=[],this.addrow.f_unit="",this.addrow.f_number="",this.addrow.f_price=""},modifyConfirm:function(){function t(){return e.apply(this,arguments)}var e=(0,f.default)(d.default.mark(function t(){return d.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.addrow.f_batch_name){t.next=3;break}return this.$showAlert("请输入预算项目","warning",1500),t.abrupt("return");case 3:if(this.addrow.f_number){t.next=6;break}return this.$showAlert("请输入数量","warning",1500),t.abrupt("return");case 6:return t.next=8,p(this);case 8:case"end":return t.stop()}},t,this)}));return t}(),update:function(t){this.updaterow=t,this.updateshow=!0},updateclose:function(){this.search(),this.updaterow=null,this.updateshow=!1},updateConfirm:function(){function t(){return e.apply(this,arguments)}var e=(0,f.default)(d.default.mark(function t(){return d.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.updaterow.f_batch_name){t.next=3;break}return this.$showAlert("请输入预算项目","warning",1500),t.abrupt("return");case 3:if(this.updaterow.f_number){t.next=6;break}return this.$showAlert("请输入数量","warning",1500),t.abrupt("return");case 6:return t.next=8,m(this);case 8:case"end":return t.stop()}},t,this)}));return t}(),delete:function(t){var e=this;this.updaterow=t,this.$showMessage("是否确认删除此预算项",["confirm","cancel"]).then(function(t){"confirm"===t&&h(e)})}},computed:{},events:{},watch:{number:function(t){this.$dispatch("get-price",t,"结算")},yusuan:function(t){this.$dispatch("get-price",t,"预算")},selectdata:function(){this.search()},"addrow.f_batch_name[0]":function(t){var e=this;this.$resetpost(this.$androidUtil.getProxyUrl()+"/rs/logic/getMaterialItem",{data:{condition:"f_name = '"+t+"' and f_use_type='预算/结算项目'"}},{resolveMsg:null,rejectMsg:null}).then(function(t){console.log("查询到的选项",t),e.addrow.f_price=t.data.material[0].f_price,e.addrow.f_unit=t.data.material[0].f_unit})},"updaterow.f_batch_name[0]":function(t){var e=this;this.$resetpost(this.$androidUtil.getProxyUrl()+"/rs/logic/getMaterialItem",{data:{condition:"f_name = '"+t+"' and f_use_type='预算/结算项目'"}},{resolveMsg:null,rejectMsg:null}).then(function(t){console.log("查询到的选项",t),e.updaterow.f_price=t.data.material[0].f_price,e.updaterow.f_unit=t.data.material[0].f_unit})}}}},799:function(t,e){t.exports=" <div class=flex style=\"height: auto\"> <div style=\"height: auto\" class=flex v-if=\"selectdata.defname=='户内安装'||selectdata.defname=='安装审核'||selectdata.defname=='工程验收'\"> <p class=\"bg-info text-center\" style=\"padding: 8px;font-size: 20px\">预算项目表 </p> <div class=\"form-inline auto\" style=\"margin-bottom: 5px\"> <criteria-paged :model=batchmodel :pager=true v-ref:paged1> <data-grid :model=$parent.batchmodel v-ref:grid1 partial=list> <template partial=head> <tr> <th> <nobr>序号</nobr> </th> <th> <nobr>预算项目</nobr> </th> <th> <nobr>单位</nobr> </th> <th> <nobr>数量</nobr> </th> <th> <nobr>单价</nobr> </th> <th> <nobr>金额</nobr> </th> </tr> </template> <template partial=body> <td style=\"text-align: center\">{{$index + 1}}</td> <td style=\"text-align: center\">{{row.f_batch_name}}</td> <td style=\"text-align: center\">{{row.f_unit}}</td> <td style=\"text-align: center\">{{row.f_number}}</td> <td style=\"text-align: center\">{{row.f_price}}</td> <td style=\"text-align: center\">{{row.f_cash}}</td> </template> </data-grid> </criteria-paged> </div> </div> <div style=\"height: auto\" class=flex> <p class=\"bg-info text-center\" style=\"padding: 8px;font-size: 20px\" v-if=\"selectdata.defname=='工商现场勘查'||selectdata.defname=='民用现场勘查'\">预算项目表 </p> <p class=\"bg-info text-center\" style=\"padding: 8px;font-size: 20px\" v-if=\"selectdata.defname=='户内安装'||selectdata.defname=='安装审核'||selectdata.defname=='点火申请'||selectdata.defname=='点火'||selectdata.defname=='收费材料费'||selectdata.defname=='工程验收'\"> 结算项目表 </p> <div class=\"form-inline auto bg-info\" v-if=\"selectdata.defname=='工商现场勘查'||selectdata.defname=='民用现场勘查'||selectdata.defname=='户内安装'\" style=\"float: right\"> <div class=form-group style=\"float: right\" v-if=\"selectdata.defname=='工商现场勘查'||selectdata.defname=='民用现场勘查'\"> <button class=\"btn btn-success\" @click=importemplate()>导入模板</button> </div> <div class=form-group style=\"float: right\" v-if=\"selectdata.defname=='户内安装'\"> <button class=\"btn btn-success\" @click=importbudget()>从预算导入</button> </div> <div class=form-group style=\"float: right\"> <button class=\"btn btn-success\" @click=modify()>新增</button> </div> </div> <div class=\"form-inline auto\" style=\"margin-bottom: 5px\"> <criteria-paged :model=model :pager=true v-ref:paged> <data-grid :model=model v-ref:grid partial=list> <template partial=head> <tr> <th> <nobr>序号</nobr> </th> <th v-if=\"$parent.$parent.$parent.selectdata.defname=='工商预算审核(技术科科长)'||$parent.$parent.$parent.selectdata.defname=='工商预算审核(分管副总)'||$parent.$parent.$parent.selectdata.defname=='工商预算审核(总经理)'||\n                  $parent.$parent.$parent.selectdata.defname=='工商现场勘查'||$parent.$parent.$parent.selectdata.defname=='民用现场勘查'\"> <nobr>预算项目</nobr> </th> <th v-if=\"$parent.$parent.$parent.selectdata.defname=='户内安装'||$parent.$parent.$parent.selectdata.defname=='安装审核'||$parent.$parent.$parent.selectdata.defname=='点火申请'||$parent.$parent.$parent.selectdata.defname=='收费材料费'||$parent.$parent.$parent.selectdata.defname=='工程验收'\"> <nobr>结算项目</nobr> </th> <th> <nobr>单位</nobr> </th> <th> <nobr>数量</nobr> </th> <th> <nobr>单价</nobr> </th> <th> <nobr>金额</nobr> </th> <th> <nobr>操作</nobr> </th> </tr> </template> <template partial=body> <td :style=\"row.f_batch_name.includes('超')?'background-color: yellow;text-align: center;':'text-align: center;'\"><font :style=\"row.f_batch_name.includes('超')?'font-weight:bold;color: blue':''\">{{$index + 1}}</font></td> <td :style=\"row.f_batch_name.includes('超')?'background-color: yellow;text-align: center;':'text-align: center;'\"><font :style=\"row.f_batch_name.includes('超')?'font-weight:bold;color: blue':''\">{{row.f_batch_name}}</font></td> <td :style=\"row.f_batch_name.includes('超')?'background-color: yellow;text-align: center;':'text-align: center;'\"><font :style=\"row.f_batch_name.includes('超')?'font-weight:bold;color: blue':''\">{{row.f_unit}}</font></td> <td :style=\"row.f_batch_name.includes('超')?'background-color: yellow;text-align: center;':'text-align: center;'\"><font :style=\"row.f_batch_name.includes('超')?'font-weight:bold;color: blue':''\">{{row.f_number}}</font></td> <td :style=\"row.f_batch_name.includes('超')?'background-color: yellow;text-align: center;':'text-align: center;'\"><font :style=\"row.f_batch_name.includes('超')?'font-weight:bold;color: blue':''\">{{row.f_price}}</font></td> <td :style=\"row.f_batch_name.includes('超')?'background-color: yellow;text-align: center;':'text-align: center;'\"><font :style=\"row.f_batch_name.includes('超')?'font-weight:bold;color: blue':''\">{{row.f_cash}}</font></td> <td :style=\"row.f_batch_name.includes('超')?'background-color: yellow;text-align: center;':'text-align: center;'\"> <div v-if=$parent.$parent.$parent.show :style=\"row.f_batch_name.includes('超')?'background-color: yellow;text-align: center;':'text-align: center;'\"> <button type=button name=button class=\"btn btn-link\" @click=$parent.$parent.$parent.update(row)>修正 </button> <button type=button name=button class=\"btn btn-link\" @click=$parent.$parent.$parent.delete(row)>移除 </button> </div> </td> </template> </data-grid> </criteria-paged> </div> </div> <modal :show.sync=modifyshow backdrop=false> <header slot=modal-header class=modal-header> <h4 class=modal-title>新增项目</h4> </header> <article slot=modal-body class=modal-body> <form class=form-horizontal> <div class=\"col-sm-3 form-group form-input-group\" style=\"width: 100%\"> <label for=f_batch_name class=control-label>项目名</label> <v-select :value.sync=addrow.f_batch_name v-model=updaterow.f_batch_name :options=material placeholder=请选择 style=\"width: 50%\" close-on-select> </v-select> </div> <div class=\"col-sm-3 form-group form-input-group\" style=\"width: 100%\"> <label for=f_number class=control-label>数量</label> <input type=number class=form-control v-model=addrow.f_number placeholder=数量> </div> </form> </article> <footer slot=modal-footer class=modal-footer> <button type=button class=\"btn btn-success\" @click=modifyConfirm>确认</button> <button type=button class=\"btn btn-default\" @click=modifyclose>取消</button> </footer> </modal> <modal :show.sync=updateshow backdrop=false> <header slot=modal-header class=modal-header> <h4 class=modal-title>修改项目名</h4> </header> <article slot=modal-body class=modal-body> <form class=form-horizontal> <div class=\"col-sm-3 form-group form-input-group\" style=\"width: 100%\"> <label for=f_batch_name class=control-label>项目名</label> <input type=text readonly=readonly class=form-control v-model=updaterow.f_batch_name placeholder=预算项目> </div> <div class=\"col-sm-3 form-group form-input-group\" style=\"width: 100%\"> <label for=f_number class=control-label>数量</label> <input type=text class=form-control v-model=updaterow.f_number placeholder=数量> </div> </form> </article> <footer slot=modal-footer class=modal-footer> <button type=button class=\"btn btn-success\" @click=updateConfirm>确认</button> <button type=button class=\"btn btn-default\" @click=updateclose>取消</button> </footer> </modal> </div> "},985:function(t,e,a){var n,r,o={};n=a(353),r=a(799),t.exports=n||{},t.exports.__esModule&&(t.exports=t.exports.default);var l="function"==typeof t.exports?t.exports.options||(t.exports.options={}):t.exports;r&&(l.template=r),l.computed||(l.computed={}),Object.keys(o).forEach(function(t){var e=o[t];l.computed[t]=function(){return e}})}});
//# sourceMappingURL=98.js.map